<!doctype html><html lang=en-US><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>AlphaAgents: Multi-Agent A2A Implementation for Collaborative Financial Analysis - Cdani's Blog</title><meta name=Description content="Cdani's Blog"><meta property="og:url" content="https://c-daniele.github.io/en/posts/2025-08-31-alphaagents-a2a/"><meta property="og:site_name" content="Cdani's Blog"><meta property="og:title" content="AlphaAgents: Multi-Agent A2A Implementation for Collaborative Financial Analysis"><meta property="og:description" content="1. Introduction The quantity of frameworks emerging for GenAI application development is incredible and, in my opinion, is becoming excessive. Every time a new framework appears, it seems to do more or less the same things as the previous one. Perhaps some have better modularization capabilities or more robust design against long-term obsolescence, but they all seem pretty much the same to me and, although I enjoy experimenting, the study of new miraculous and promising GenAI frameworks is becoming less and less appealing."><meta property="og:locale" content="en_US"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-08-31T00:00:00+02:00"><meta property="article:modified_time" content="2025-08-31T00:00:00+02:00"><meta property="article:tag" content="GenAI"><meta property="article:tag" content="Langchain"><meta property="article:tag" content="Agents"><meta property="og:image" content="https://c-daniele.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://c-daniele.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="AlphaAgents: Multi-Agent A2A Implementation for Collaborative Financial Analysis"><meta name=twitter:description content="1. Introduction The quantity of frameworks emerging for GenAI application development is incredible and, in my opinion, is becoming excessive. Every time a new framework appears, it seems to do more or less the same things as the previous one. Perhaps some have better modularization capabilities or more robust design against long-term obsolescence, but they all seem pretty much the same to me and, although I enjoy experimenting, the study of new miraculous and promising GenAI frameworks is becoming less and less appealing."><meta name=application-name content="Cdani's Blog"><meta name=apple-mobile-web-app-title content="Cdani's Blog"><meta name=referrer content="no-referrer"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel=icon href=/logo_cd_v3.svg><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#00872b><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://c-daniele.github.io/en/posts/2025-08-31-alphaagents-a2a/><link rel=prev href=https://c-daniele.github.io/en/posts/2025-08-15-agent-reg-for-a2a/><link rel=next href=https://c-daniele.github.io/en/posts/2025-10-11-bells-inequalities/><link rel=stylesheet href=/css/style.min.css><link rel=preload href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.2/css/all.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.2/css/all.min.css></noscript><link rel=preload href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"AlphaAgents: Multi-Agent A2A Implementation for Collaborative Financial Analysis","inLanguage":"en-US","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/c-daniele.github.io\/en\/posts\/2025-08-31-alphaagents-a2a\/"},"genre":"posts","keywords":"GenAI, Langchain, Agents","wordcount":8349,"url":"https:\/\/c-daniele.github.io\/en\/posts\/2025-08-31-alphaagents-a2a\/","datePublished":"2025-08-31T00:00:00+02:00","dateModified":"2025-08-31T00:00:00+02:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"Me"},"description":""}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script>const query=window.matchMedia("(prefers-color-scheme: dark)");function applyTheme(){let e=window.localStorage?.getItem("theme")||"auto",t=e==="dark"||e==="auto"&&query.matches;document.body.setAttribute("theme",t?"dark":"light"),document.body.setAttribute("cfg-theme",e)}applyTheme(),query.addEventListener("change",applyTheme)</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/en/ title="Cdani's Blog"><img class="lazyload logo" src=/svg/loading.min.svg data-src=/logo_cd_v3.svg data-srcset="/logo_cd_v3.svg, /logo_cd_v3.svg 1.5x, /logo_cd_v3.svg 2x" data-sizes=auto alt=/logo_cd_v3.svg title=/logo_cd_v3.svg>Cdani's Blog</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/en/posts/>Archive </a><a class=menu-item href=/en/tags/>Tags </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder=Search... id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=Search><i class="fas fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=Clear><i class="fas fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i>
</span></span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><i class="fas fa-adjust fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="menu-item language" title="Select Language"><i class="fa fa-globe fa-fw" aria-hidden=true></i>
<select class=language-select id=language-select-desktop onchange="location=this.value"><option value=/it/posts/2025-08-31-alphaagents-a2a/>Italiano</option><option value=/en/posts/2025-08-31-alphaagents-a2a/ selected>English</option></select></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/en/ title="Cdani's Blog"><img class="lazyload logo" src=/svg/loading.min.svg data-src=/logo_cd_v3.svg data-srcset="/logo_cd_v3.svg, /logo_cd_v3.svg 1.5x, /logo_cd_v3.svg 2x" data-sizes=auto alt=/logo_cd_v3.svg title=/logo_cd_v3.svg>Cdani's Blog</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=Search... id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=Search><i class="fas fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=Clear><i class="fas fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>Cancel</a></div><a class=menu-item href=/en/posts/ title>Archive</a><a class=menu-item href=/en/tags/ title>Tags</a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class=menu-item title="Select Language"><i class="fa fa-globe fa-fw" aria-hidden=true></i>
<select class=language-select onchange="location=this.value"><option value=/it/posts/2025-08-31-alphaagents-a2a/>Italiano</option><option value=/en/posts/2025-08-31-alphaagents-a2a/ selected>English</option></select></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">AlphaAgents: Multi-Agent A2A Implementation for Collaborative Financial Analysis</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/en/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>Me</a></span>&nbsp;<span class=post-category>included in <a href=/en/categories/software-development/><i class="far fa-folder fa-fw" aria-hidden=true></i>Software Development</a>&nbsp;<a href=/en/categories/artificial-intelligence/><i class="far fa-folder fa-fw" aria-hidden=true></i>Artificial Intelligence</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime="August 31, 2025">August 31, 2025</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;8349 words&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;40 minutes&nbsp;</div></div><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#21-the-problem-and-solution>2.1 The Problem and Solution</a></li><li><a href=#22-the-three-agents>2.2 The Three Agents</a></li><li><a href=#23-collaboration-and-debate-mechanism>2.3 Collaboration and Debate Mechanism</a></li><li><a href=#24-intelligent-risk-tolerance-management>2.4 Intelligent Risk Tolerance Management</a><ul><li><a href=#241-risk-profile-classification>2.4.1 Risk Profile Classification</a></li><li><a href=#242-automatic-classification-examples>2.4.2 Automatic Classification Examples</a></li><li><a href=#243-integration-in-the-debate-process>2.4.3 Integration in the Debate Process</a></li></ul></li><li><a href=#25-advantages-of-multi-agent-approach-with-structured-debate>2.5 Advantages of Multi-Agent Approach with Structured Debate</a></li></ul><ul><li><a href=#41-overall-logical-architecture>4.1 Overall Logical Architecture</a></li><li><a href=#42-registration-process>4.2 Registration Process</a></li><li><a href=#43-agent-card>4.3 Agent Card</a></li><li><a href=#44-end-to-end-analysis-flow>4.4 End-to-End Analysis Flow</a></li><li><a href=#45-transport-layer-and-messaging-protocol>4.5 Transport Layer and Messaging Protocol</a></li></ul><ul><li><a href=#51-technology-stack-and-dependencies>5.1 Technology Stack and Dependencies</a></li><li><a href=#52-project-structure>5.2 Project Structure</a></li><li><a href=#53-group-chat-agent-implementation>5.3 Group Chat Agent Implementation</a><ul><li><a href=#531-risk-tolerance-inference>5.3.1 Risk Tolerance Inference</a></li><li><a href=#532-code-excerpt>5.3.2 Code Excerpt</a></li></ul></li><li><a href=#54-a2a-communication-patterns>5.4 A2A Communication Patterns</a></li><li><a href=#55-specialized-agent-implementation>5.5 Specialized Agent Implementation</a><ul><li><a href=#551-fundamental-agent>5.5.1 Fundamental Agent</a></li><li><a href=#552-sentiment-agent---vader-implementation>5.5.2 Sentiment Agent - VADER Implementation</a></li><li><a href=#553-fundamental-agent---keyword-based-implementation>5.5.3 Fundamental Agent - Keyword-Based Implementation</a></li><li><a href=#554-valuation-agent-tools>5.5.4 Valuation Agent Tools</a></li></ul></li><li><a href=#56-agent-registration-and-discovery>5.6 Agent Registration and Discovery</a></li><li><a href=#57-consolidation-pattern-with-llm>5.7 Consolidation Pattern with LLM</a></li><li><a href=#58-current-implementation-simplifications>5.8 Current Implementation Simplifications</a></li></ul><ul><li><a href=#61-phase-1-initialization-and-ecosystem-setup>6.1 Phase 1: Initialization and Ecosystem Setup</a><ul><li><a href=#611-agent-registry-startup>6.1.1 Agent Registry Startup</a></li><li><a href=#612-specialized-agent-startup>6.1.2 Specialized Agent Startup</a></li><li><a href=#613-group-chat-agent-startup>6.1.3 Group Chat Agent Startup</a></li></ul></li><li><a href=#62-phase-2-query-reception-and-parsing>6.2 Phase 2: Query Reception and Parsing</a><ul><li><a href=#621-json-rpc-a2a-request>6.2.1 JSON-RPC A2A Request</a></li><li><a href=#622-conversion-to-a2a-message-format>6.2.2 Conversion to A2A Message Format</a></li></ul></li><li><a href=#63-phase-3-automatic-risk-tolerance-inference>6.3 Phase 3: Automatic Risk Tolerance Inference</a><ul><li><a href=#631-llm-call-for-risk-assessment>6.3.1 LLM Call for Risk Assessment</a></li></ul></li><li><a href=#64-phase-4-agent-discovery-and-intelligent-routing>6.4 Phase 4: Agent Discovery and Intelligent Routing</a><ul><li><a href=#641-agent-card-retrieval-from-agent-registry>6.4.1 Agent Card Retrieval from Agent Registry</a></li><li><a href=#642-routing-llm-for-agent-selection>6.4.2 Routing LLM for Agent Selection</a></li><li><a href=#643-decision-for-structured-debate>6.4.3 Decision for Structured Debate</a></li></ul></li><li><a href=#65-phase-5-round-1---initial-analysis>6.5 Phase 5: Round 1 - Initial Analysis</a><ul><li><a href=#651-valuation-agent---round-1>6.5.1 Valuation Agent - Round 1</a></li><li><a href=#652-sentiment-agent---round-1>6.5.2 Sentiment Agent - Round 1</a></li><li><a href=#653-fundamental-agent---round-1>6.5.3 Fundamental Agent - Round 1</a></li></ul></li><li><a href=#66-round-2-debate>6.6 Round 2 Debate</a><ul><li><a href=#661-debate>6.6.1 Debate</a></li><li><a href=#662-consensus-building-process>6.6.2 Consensus Building Process</a></li></ul></li><li><a href=#67-phase-7-final-consolidation-and-report-generation>6.7 Phase 7: Final Consolidation and Report Generation</a><ul><li><a href=#671-llm-based-synthesis>6.7.1 LLM-based Synthesis</a></li><li><a href=#672-final-report>6.7.2 Final Report</a></li><li><a href=#673-debate-process-metadata>6.7.3 Debate Process Metadata</a></li></ul></li><li><a href=#68-performance-and-execution-times>6.8 Performance and Execution Times</a><ul><li><a href=#681-overall-duration>6.8.1 Overall Duration</a></li><li><a href=#682-temporal-breakdown-by-phases>6.8.2 Temporal Breakdown by Phases</a></li><li><a href=#683-analysis-of-most-expensive-components>6.8.3 Analysis of Most Expensive Components</a></li><li><a href=#684-bottlenecks-and-possible-optimizations>6.8.4 Bottlenecks and Possible Optimizations</a></li><li><a href=#685-performance-considerations>6.8.5 Performance Considerations</a></li></ul></li><li><a href=#69-end-to-end-process-conclusions>6.9 End-to-End Process Conclusions</a></li></ul><ul><li><a href=#71-project-motivations-and-objectives>7.1 Project Motivations and Objectives</a></li><li><a href=#72-the-choice-of-alphaagents>7.2 The Choice of AlphaAgents</a></li><li><a href=#73-future-developments>7.3 Future Developments</a><ul><li><a href=#741-technical-improvements>7.4.1 Technical Improvements</a></li><li><a href=#742-functional-expansions>7.4.2 Functional Expansions</a></li></ul></li><li><a href=#75-considerations-on-financial-results>7.5 Considerations on Financial Results</a><ul><li><a href=#751-limitations-and-risks>7.5.1 Limitations and Risks</a></li><li><a href=#752--important-disclaimer>7.5.2 ‚ö†Ô∏è Important Disclaimer</a></li></ul></li></ul></nav></div></div><div class=content id=content><h1 id=1-introduction>1. Introduction</h1><p>The quantity of frameworks emerging for GenAI application development is incredible and, in my opinion, is becoming excessive.
Every time a new framework appears, it seems to do more or less the same things as the previous one. Perhaps some have better modularization capabilities or more robust design against long-term obsolescence, but they all seem pretty much the same to me and, although I enjoy experimenting, the study of new miraculous and promising GenAI frameworks is becoming less and less appealing.</p><p>Just to give you an idea, a few days ago, I came across <a href=https://mozilla-ai.github.io/any-agent/ target=_blank rel="noopener noreffer">AnyAgent</a>: yet another framework that acts as a wrapper for other frameworks!<br></p><p>Don&rsquo;t get me wrong, the work that Mozilla&rsquo;s AI team is doing is commendable and I also recommend reading their <a href=https://blog.mozilla.ai/ target=_blank rel="noopener noreffer">blog</a>, which publishes very interesting articles, but this kind of <em>Kafkaesque</em> superstructure seems to introduce more problems than it solves because each stratification complicates software maintainability in the long run, not to mention all the issues with dependencies, compatibility, and updates.</p><p>I also find it unnecessarily wasteful to specialize vertically in one framework or another, both for lock-in issues and to not lose that abstraction capability I need in designing an end-to-end solution.</p><p>Another area where almost all frameworks are showing their limitations is in <strong>multi-agent support</strong>.
The very first GenAI development frameworks focused primarily on LLM wrapping, tracing, and chaining, while now most attention is directed toward <em>agentic</em> (I hate this word) capabilities, but in the vast majority of cases, the original framework design has remained the same.</p><p>Most of these frameworks are still <strong>monolithic</strong>, making it <strong>difficult to realize a true multi-agent application</strong> without being constrained to the specific framework and underlying runtime.</p><p>This is where A2A (Agent-to-Agent) comes into play. The A2A protocol aims to enable smooth communication and collaboration between agents, regardless of the framework or runtime used, through standardized messaging formats and transport protocols.
Rather than continuing to study or delve deeper into this or that framework, I decided to <strong>take the A2A protocol seriously</strong> and try to implement an end-to-end application solution compatible with this standard.</p><p>The first step was solving the discovery problem, and in <a href=https://c-daniele.github.io/en/posts/2025-08-15-agent-reg-for-a2a/ target=_blank rel="noopener noreffer">my previous post</a> I described how to build a simple Agent Registry that fits well with the A2A protocol.</p><p>Subsequently, I wanted to dive into a concrete use case, so I looked for an interesting application to tackle with my new A2A-compliant Multi-Agent architecture.
I then happened to come across the <a href=https://arxiv.org/abs/2508.11152v1 target=_blank rel="noopener noreffer">AlphaAgents</a> paper, published a few days ago on arXiv by the BlackRock team.</p><p>The paper describes a multi-agent collaboration approach to <strong>support stock selection and financial analysis starting from a set of securities</strong>. I thought it was a perfect use case and jumped right in!</p><p>Unfortunately, the BlackRock team did not release the source code, so I had to implement the entire AlphaAgent solution <a href=https://github.com/c-daniele/alpha-agents-a2a target=_blank rel="noopener noreffer">by myself</a>, using the paper as a high-level specification. I still had to make some assumptions and trade-offs; for example, the information extraction and synthesis tools for the fundamental analysis agent do not actually use RAG, but rather very basic keyword or prefix lookup techniques based on the data returned by Yahoo Finance. As a result, the implementation is not 100% compliant with what is described in the paper, but it can serve as a valid starting point.</p><p>In any case, my focus was more on the architecture than on the reliability of the individual agents&rsquo; responses. I also aimed for an agnostic approach regarding the underlying GenAI framework, where the orchestrator agent can <strong>search for and select specialized agents at runtime</strong>, thus completely ignoring the underlying details in terms of models, languages, and libraries.</p><p>In the following chapters, I‚Äôll briefly recap what AlphaAgents is and how it works in theory, then describe the architecture of my A2A-compliant implementation and some technical details, and finally show what happens during each step of a concrete execution.</p><p>I‚Äôll add a disclaimer that‚Äôs probably obvious but mandatory: the system output is intended purely as a demonstration of the multi-agent solution and <strong>should not be considered in any way as input for any type of financial decision</strong>. I also point out that, although I&rsquo;ve performed some spot checks for consistency on the calculated KPIs and found results more or less in line with expectations, <strong>no thorough or rigorous validation</strong> of the results was performed. Therefore, I cannot rule out the possibility of systematic errors or responses influenced by LLM hallucinations.</p><h1 id=2-brief-introduction-to-alphaagents>2. Brief Introduction to AlphaAgents</h1><p>The <a href=https://arxiv.org/abs/2508.11152v1 target=_blank rel="noopener noreffer">AlphaAgents</a> paper introduces an innovative approach to the stock selection problem through a multi-agent system based on Large Language Models (LLMs).</p><h2 id=21-the-problem-and-solution>2.1 The Problem and Solution</h2><p>Traditional portfolio analysis requires considerable human effort to process enormous amounts of heterogeneous data: SEC documents (10-K, 10-Q), earnings call transcripts, target prices, financial ratios, market news, and sector research. This process also presents significant challenges in terms of scalability and objectivity. One of the risks cited multiple times in the paper is that of leaning toward sub-optimal allocations due to <strong>subjective factors such as risk aversion</strong> or excessive confidence in one&rsquo;s intuitions.</p><p>AlphaAgents address these problems through a multi-agent framework that <strong>incorporates some adversarial reasoning techniques</strong> and divides financial analysis into distinct specialization areas, each managed by a dedicated agent.</p><h2 id=22-the-three-agents>2.2 The Three Agents</h2><p><strong>Fundamental Agent</strong>: Handles traditional fundamental analysis, examining financial statements, cash flows, and financial performance in depth through analysis of SEC documents and financial reports.</p><p><strong>Sentiment Agent</strong>: Analyzes market sentiment through processing financial news, analyst rating changes, and corporate disclosures to assess potential impact on stock prices.</p><p><strong>Valuation Agent</strong>: Focuses on technical and quantitative analysis, processing historical price and volume data to calculate volatility metrics, risk-adjusted returns, and valuation indicators.</p><h2 id=23-collaboration-and-debate-mechanism>2.3 Collaboration and Debate Mechanism</h2><p>The framework implements a centralized coordination mechanism through a <strong>Group Chat Agent</strong> that manages interaction between specialized agents. This coordinator agent:</p><ol><li><strong>Routes requests</strong> to the most appropriate agents based on the type of analysis required using an LLM-based approach</li><li><strong>Manages the structured debate process</strong> implementing a round-robin approach</li><li><strong>Ensures fair participation</strong> by ensuring each agent speaks at least twice during the debate</li><li><strong>Facilitates convergence</strong> through a consensus building system that involves sharing intermediate results with all agents</li><li><strong>Synthesizes multiple analyses</strong> into a coherent report highlighting the debate process</li><li><strong>Mitigates hallucinations</strong> through cross-agent comparison and collaborative validation</li></ol><p>In summary: agents engage in sequential turns until consensus is reached, eliminating the risk that some agents dominate the discussion.</p><div class=mermaid id=id-1></div><h2 id=24-intelligent-risk-tolerance-management>2.4 Intelligent Risk Tolerance Management</h2><p>One innovative aspect of the framework is the incorporation of risk tolerance profiles indicated by the user. The paper doesn&rsquo;t specify precisely how the BlackRock team implemented the introduction of these profiles, but I hypothesize they used prompting mechanisms to <strong>automatically infer</strong> the risk level from the user query.
Starting from this query analysis, a precise indication of the desired risk profile is then extrapolated, which is then used in all interactions with the agents.</p><p>This simple expedient therefore allows adding a level of personalization to the recommendations provided by the agents.</p><h3 id=241-risk-profile-classification>2.4.1 Risk Profile Classification</h3><ul><li><strong>Risk-averse</strong>: Conservative investors who prioritize capital preservation, stable returns, dividend-paying stocks, low volatility, safety-first approach</li><li><strong>Risk-neutral</strong>: Balanced investors seeking moderate growth with reasonable risk, diversified portfolios, standard market exposure</li><li><strong>Risk-seeking</strong>: Aggressive investors pursuing high returns, accepting high volatility, growth stocks, speculative investments</li></ul><h3 id=242-automatic-classification-examples>2.4.2 Automatic Classification Examples</h3><div class="code-block code-line-numbers" style="counter-reset:code-block 0"><div class="code-header language-plaintext"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=cl>üü¢ Risk-Averse (Conservative):
</span></span><span class=line><span class=cl>&#34;I&#39;m looking for safe and stable investments for my retirement&#34;
</span></span><span class=line><span class=cl>&#34;I&#39;m looking for safe stocks with regular dividends&#34;
</span></span><span class=line><span class=cl>&#34;I want to preserve my capital without risks&#34;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>üü° Risk-Neutral (Balanced):  
</span></span><span class=line><span class=cl>&#34;Should I invest in Tesla? I want a balanced analysis&#34;
</span></span><span class=line><span class=cl>&#34;Should I invest in Apple stock?&#34;
</span></span><span class=line><span class=cl>&#34;Microsoft stock analysis for my portfolio&#34;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>üî¥ Risk-Seeking (Aggressive):
</span></span><span class=line><span class=cl>&#34;I want high-growth stocks even if volatile&#34;
</span></span><span class=line><span class=cl>&#34;I want maximum returns, I can handle high risk&#34;
</span></span><span class=line><span class=cl>&#34;I&#39;m looking for high-potential investments&#34;</span></span></code></pre></div></div><h3 id=243-integration-in-the-debate-process>2.4.3 Integration in the Debate Process</h3><p>The inferred risk profile is automatically:</p><ul><li><strong>Passed to all specialized agents</strong> via metadata in the JSON-RPC message</li><li><strong>Maintained throughout the debate</strong> for recommendation consistency</li><li><strong>Logged</strong> for decision process transparency</li><li><strong>Used to personalize</strong> the analyses of each specialist agent</li></ul><h2 id=25-advantages-of-multi-agent-approach-with-structured-debate>2.5 Advantages of Multi-Agent Approach with Structured Debate</h2><p>The system offers several benefits compared to traditional analysis:</p><ul><li><strong>Bias mitigation</strong>: Each agent operates independently, reducing the impact of human cognitive biases</li><li><strong>Fair participation</strong>: The turn-taking mechanism allows all agents to contribute fairly</li><li><strong>Collaborative validation</strong>: Individual positions are challenged and refined through direct confrontation</li><li><strong>Guided convergence</strong>: The consensus building system leads to more robust and thoughtful decisions</li><li><strong>Automatic personalization</strong>: Risk tolerance inferred automatically for tailored analyses</li><li><strong>Multilingual adaptation</strong>: Native system for users of any language without configuration</li><li><strong>Scalability</strong>: Ability to process much larger volumes of information</li><li><strong>Specialization</strong>: Each agent can develop deep expertise in its domain</li><li><strong>Flexibility</strong>: The framework can be extended with additional agents (e.g., Technical Analysis Agent, Macro Economist Agent)</li></ul><h1 id=3-starting-point>3. Starting Point</h1><p>To implement the code, I made extensive use of Claude Code, but I dedicated a significant amount of time to defining the detailed technical specifications compared to what I had in mind after reading the paper (e.g., class structure, tool management, etc.), as well as testing and modifying or revising some classes and methods.</p><p>Assuming that each agent could be implemented independently, I based myself for simplicity on the following ecosystem:</p><ul><li>Runtime: Python3.12</li><li>Package manager: uv</li><li>GenAI Framework: Langchain Agents (but it could be replaced with another framework like Autogen, CrewAI, Smolagents, etc)</li><li>Serving Layer: FastAPI</li><li>Communication protocol: JSON-RPC</li><li>Testing: simple relaunchable python scripts</li><li>Architecture based on Agent Registry, with dynamic discovery of Agent Card for each agent</li><li>LLM: for simplicity I used GPT-4o, without worrying too much about model choice</li></ul><p>In the following chapters, I illustrate in detail the architecture and implementation. Obviously, one of the preparatory steps was also to equip each agent with an endpoint to expose the Agent Card according to the usual &ldquo;<em>.well-known/agent-card</em>&rdquo; path and register the agents within the Agent Registry (Figure 1)</p><table><thead><tr><th style=text-align:center><a href=/images/2025/add-val-agent.png><img src=/images/2025/add-val-agent.png alt="Figure 1 - Adding the Valuation Agent"></a></th></tr></thead><tbody><tr><td style=text-align:center><em>Figure 1 - Adding the Valuation Agent</em></td></tr></tbody></table><h1 id=4-high-level-design>4. High-Level Design</h1><p>The architecture is quite simple: it consists of:</p><ul><li>1 Agent Registry that manages agent registration and discovery (this is the module I discussed in <a href=https://c-daniele.github.io/en/posts/2025-08-15-agent-reg-for-a2a/ target=_blank rel="noopener noreffer">my previous article</a>)</li><li>3 specialized agents, each running on a specific host and port (in my case, localhost and ports 3001-3003)</li><li>1 orchestration agent, which receives user inputs, calls other agents, and produces the final response.</li></ul><h2 id=41-overall-logical-architecture>4.1 Overall Logical Architecture</h2><p>I launched all agents locally and configured the Agent Cards accordingly, but obviously the system is designed to also support distributed deployments.</p><div class=mermaid id=id-2></div><h2 id=42-registration-process>4.2 Registration Process</h2><p>In my case, I manually performed registration on the agent registry (Figure 1), however the process could easily be automated. Essentially, each Agent that wants to be published within the organization could autonomously register on the Agent Registry.</p><p>Whether in the case of manual or automatic registration, the Group Chat Agent can then query the Agent Registry and discover the specialized agents needed to respond to a user request and decide how to orchestrate communication between them.</p><div class=mermaid id=id-3></div><h2 id=43-agent-card>4.3 Agent Card</h2><p>Each agent exposes its capabilities through an Agent Card compliant with the A2A schema. For example, here is the Agent Card for the Fundamental Agent:</p><div class="code-block code-line-numbers" style="counter-reset:code-block 0"><div class="code-header language-json"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;Fundamental Analysis Agent&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;description&#34;</span><span class=p>:</span> <span class=s2>&#34;Specialized agent for fundamental equity analysis. Analyzes 10-K and 10-Q financial reports, financial statements, and company fundamentals to assess stock value and projected trajectory. Provides qualitative and quantitative analysis of a company&#39;s financial performance, cash flow, operations, gross margins, and progress towards stated objectives.&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;version&#34;</span><span class=p>:</span> <span class=s2>&#34;1.0.0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;protocolVersion&#34;</span><span class=p>:</span> <span class=s2>&#34;0.3.0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;url&#34;</span><span class=p>:</span> <span class=s2>&#34;http://0.0.0.0:3003/&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;preferredTransport&#34;</span><span class=p>:</span> <span class=s2>&#34;JSONRPC&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;provider&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;organization&#34;</span><span class=p>:</span> <span class=s2>&#34;AlphaAgents Financial&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;url&#34;</span><span class=p>:</span> <span class=s2>&#34;https://AlphaAgents-dummy-corp.ai&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;capabilities&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;streaming&#34;</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;pushNotifications&#34;</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;stateTransitionHistory&#34;</span><span class=p>:</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;defaultInputModes&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;text/plain&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;application/json&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;application/pdf&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>],</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;defaultOutputModes&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;text/plain&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;application/json&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>],</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;skills&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;id&#34;</span><span class=p>:</span> <span class=s2>&#34;fundamental_analysis&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;Fundamental Financial Analysis&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;description&#34;</span><span class=p>:</span> <span class=s2>&#34;Performs comprehensive fundamental analysis of stocks using 10-K and 10-Q reports. Analyzes financial statements, cash flow, income statements, balance sheets, operations, gross margins, and company progress towards objectives. Provides buy/sell/hold recommendations based on fundamental metrics and risk tolerance.&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;tags&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;financial-analysis&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;10k-reports&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;10q-reports&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;financial-statements&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;cash-flow-analysis&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;fundamental-research&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;equity-valuation&#34;</span>
</span></span><span class=line><span class=cl>      <span class=p>],</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;examples&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Analyze Apple&#39;s latest 10-K report and provide a fundamental analysis with recommendation&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Evaluate Microsoft&#39;s cash flow trends and operational efficiency from recent financial filings&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Compare Tesla&#39;s fundamental metrics against industry benchmarks and provide investment recommendation&#34;</span>
</span></span><span class=line><span class=cl>      <span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;id&#34;</span><span class=p>:</span> <span class=s2>&#34;financial_report_extraction&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;Financial Report Data Extraction&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;description&#34;</span><span class=p>:</span> <span class=s2>&#34;Extracts and processes key financial data from 10-K and 10-Q SEC filings. Uses RAG capabilities to retrieve relevant sections and perform targeted analysis on specific financial metrics, ratios, and disclosures.&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;tags&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;data-extraction&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;sec-filings&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;financial-metrics&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;rag-analysis&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;document-processing&#34;</span>
</span></span><span class=line><span class=cl>      <span class=p>],</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;examples&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Extract revenue growth metrics from the latest quarterly report&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Pull debt-to-equity ratios and leverage analysis from annual filing&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Identify key risk factors mentioned in the 10-K management discussion&#34;</span>
</span></span><span class=line><span class=cl>      <span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;id&#34;</span><span class=p>:</span> <span class=s2>&#34;risk_assessment&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;Fundamental Risk Assessment&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;description&#34;</span><span class=p>:</span> <span class=s2>&#34;Assesses fundamental risks based on financial health indicators, debt levels, cash flow stability, competitive positioning, and management guidance. Tailors analysis to different risk tolerance profiles (risk-averse, risk-neutral).&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;tags&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;risk-assessment&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;financial-health&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;debt-analysis&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;competitive-analysis&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;risk-tolerance&#34;</span>
</span></span><span class=line><span class=cl>      <span class=p>],</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;examples&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Assess the fundamental risk profile of Netflix given current debt levels and competitive pressures&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Evaluate Amazon&#39;s financial stability risks for risk-averse investors&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Analyze fundamental downside risks for Google&#39;s cloud business segment&#34;</span>
</span></span><span class=line><span class=cl>      <span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>],</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;additionalInterfaces&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;url&#34;</span><span class=p>:</span> <span class=s2>&#34;http://0.0.0.0:3003/&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;transport&#34;</span><span class=p>:</span> <span class=s2>&#34;JSONRPC&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div><h2 id=44-end-to-end-analysis-flow>4.4 End-to-End Analysis Flow</h2><p>The analysis process requires the orchestrator (the group chat) to execute an <strong>intelligent routing system</strong> based on LLM that:</p><ul><li><strong>Automatically detects</strong> whether the query requires structured debate (investment decisions) or simple coordination (informational queries)</li><li><strong>Determines which agents to involve</strong> to perform detailed analysis using multilingual semantic analysis</li><li><strong>Manages the Round Robin debate process</strong> when necessary, ensuring at least 2 turns per agent</li></ul><p>For questions regarding <strong>investment decisions</strong>, the system activates the <strong>structured debate mechanism</strong>:</p><ol><li><strong>Initial round</strong>: Each agent presents its initial position sequentially</li><li><strong>Debate rounds</strong>: Agents confront each other in turns, presenting counter-arguments</li><li><strong>Consensus check</strong>: Verification of 75% agreement after each round</li><li><strong>Participation enforcement</strong>: Ensures minimum 2 turns per agent</li><li><strong>Final synthesis</strong>: Consolidates final positions highlighting the debate process</li></ol><p>For <strong>informational queries</strong>, the system uses <strong>traditional parallel coordination</strong> to maximize speed and efficiency.</p><div class=mermaid id=id-4></div><h2 id=45-transport-layer-and-messaging-protocol>4.5 Transport Layer and Messaging Protocol</h2><p>All inter-agent traffic uses A2A-compliant JSON-RPC protocol:</p><p><strong>Request Format:</strong></p><div class="code-block code-line-numbers" style="counter-reset:code-block 0"><div class="code-header language-json"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;jsonrpc&#34;</span><span class=p>:</span> <span class=s2>&#34;2.0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;method&#34;</span><span class=p>:</span> <span class=s2>&#34;message/send&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;params&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;message&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;kind&#34;</span><span class=p>:</span> <span class=s2>&#34;message&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;messageId&#34;</span><span class=p>:</span> <span class=s2>&#34;uuid&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;role&#34;</span><span class=p>:</span> <span class=s2>&#34;user&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;parts&#34;</span><span class=p>:</span> <span class=p>[{</span><span class=nt>&#34;kind&#34;</span><span class=p>:</span> <span class=s2>&#34;text&#34;</span><span class=p>,</span> <span class=nt>&#34;text&#34;</span><span class=p>:</span> <span class=s2>&#34;Analyze AAPL&#34;</span><span class=p>}],</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;contextId&#34;</span><span class=p>:</span> <span class=s2>&#34;uuid&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;taskId&#34;</span><span class=p>:</span> <span class=s2>&#34;uuid&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;metadata&#34;</span><span class=p>:</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;id&#34;</span><span class=p>:</span> <span class=s2>&#34;uuid&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div><p><strong>Response Format:</strong></p><div class="code-block code-line-numbers" style="counter-reset:code-block 0"><div class="code-header language-json"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;jsonrpc&#34;</span><span class=p>:</span> <span class=s2>&#34;2.0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;result&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;kind&#34;</span><span class=p>:</span> <span class=s2>&#34;message&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=nt>&#34;messageId&#34;</span><span class=p>:</span> <span class=s2>&#34;uuid&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;role&#34;</span><span class=p>:</span> <span class=s2>&#34;agent&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;parts&#34;</span><span class=p>:</span> <span class=p>[{</span><span class=nt>&#34;kind&#34;</span><span class=p>:</span> <span class=s2>&#34;text&#34;</span><span class=p>,</span> <span class=nt>&#34;text&#34;</span><span class=p>:</span> <span class=s2>&#34;Analysis results...&#34;</span><span class=p>}],</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;contextId&#34;</span><span class=p>:</span> <span class=s2>&#34;uuid&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;metadata&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;analysis_type&#34;</span><span class=p>:</span> <span class=s2>&#34;fundamental&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;confidence_score&#34;</span><span class=p>:</span> <span class=mf>0.85</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;id&#34;</span><span class=p>:</span> <span class=s2>&#34;uuid&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div><h1 id=5-implementation>5. Implementation</h1><p>The AlphaAgents implementation was created with a focus on modularity, testability, and A2A protocol compliance. Each agent is an independent application with its own dependencies and can be deployed separately.</p><p><strong>Implementation Note</strong>: As mentioned in the introduction, the implementation differs from the original paper in some technical aspects. In particular:</p><ul><li>The <strong>Sentiment Agent</strong> uses VADER and TextBlob libraries which should represent a simple but effective solution since presumably news will be exclusively in English and won&rsquo;t require deep contextual understanding. In the future, more sophisticated sentiment analysis models based on LLM or specific models like FinBERT could be integrated.</li><li>The <strong>Fundamental Agent</strong> employs keyword matching on Yahoo Finance data instead of true RAG techniques with vector databases</li><li>In general, I focused on architecture rather than specific performance of individual agents</li></ul><p>All code is available on <a href=https://github.com/c-daniele/alpha-agents-a2a target=_blank rel="noopener noreffer">GitHub</a>.</p><h2 id=51-technology-stack-and-dependencies>5.1 Technology Stack and Dependencies</h2><p>The project uses <strong>Python 3.12</strong> as runtime with <strong>uv</strong> as package manager for rapid dependency management. Below is an excerpt from the configuration file to give an idea of dependencies:</p><div class="code-block code-line-numbers" style="counter-reset:code-block 0"><div class="code-header language-toml"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-toml data-lang=toml><span class=line><span class=cl><span class=c># pyproject.toml - Global Dependencies</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nx>project</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=nx>name</span> <span class=p>=</span> <span class=s2>&#34;alpha_agents&#34;</span>
</span></span><span class=line><span class=cl><span class=nx>version</span> <span class=p>=</span> <span class=s2>&#34;0.1.0&#34;</span>
</span></span><span class=line><span class=cl><span class=nx>requires-python</span> <span class=p>=</span> <span class=s2>&#34;&gt;=3.12&#34;</span>
</span></span><span class=line><span class=cl><span class=nx>dependencies</span> <span class=p>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;langchain&gt;=0.3.27&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;langchain-openai&gt;=0.3.32&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;langchain-community&gt;=0.3.28&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;openai&gt;=1.102.0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;yfinance&gt;=0.2.65&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;pandas&gt;=2.3.2&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;numpy&gt;=2.3.2&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;fastapi&gt;=0.116.1&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;uvicorn&gt;=0.35.0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;pydantic&gt;=2.11.7&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;python-dotenv&gt;=1.1.1&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;httpx&gt;=0.28.1&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;aiohttp&gt;=3.12.15&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;requests&gt;=2.32.5&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;beautifulsoup4&gt;=4.13.5&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;feedparser&gt;=6.0.11&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;newspaper3k&gt;=0.2.8&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;textblob&gt;=0.18.0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;vaderSentiment&gt;=3.3.2&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;python-dateutil&gt;=2.9.0&#34;</span>
</span></span><span class=line><span class=cl><span class=p>]</span></span></span></code></pre></div></div><h2 id=52-project-structure>5.2 Project Structure</h2><p>Below is an overview of the project structure:</p><div class="code-block code-line-numbers" style="counter-reset:code-block 0"><div class="code-header language-plaintext"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=cl>alpha-agents-implementation/
</span></span><span class=line><span class=cl>‚îú‚îÄ‚îÄ agents/
</span></span><span class=line><span class=cl>‚îÇ   ‚îú‚îÄ‚îÄ groupchat-agent/          # Main orchestrator
</span></span><span class=line><span class=cl>‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ src/groupchat_agent/
</span></span><span class=line><span class=cl>‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ a2a_agent.py      # Coordination logic
</span></span><span class=line><span class=cl>‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ registry_service.py # Agent Registry client
</span></span><span class=line><span class=cl>‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ server.py         # FastAPI server
</span></span><span class=line><span class=cl>‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ pyproject.toml
</span></span><span class=line><span class=cl>‚îÇ   ‚îú‚îÄ‚îÄ fundamental-agent/        # Fundamental analysis
</span></span><span class=line><span class=cl>‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ src/fundamental_agent/
</span></span><span class=line><span class=cl>‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ agent.py          # Langchain agent
</span></span><span class=line><span class=cl>‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ tools.py          # SEC/Finance tools
</span></span><span class=line><span class=cl>‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ server.py         # A2A endpoint
</span></span><span class=line><span class=cl>‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ pyproject.toml
</span></span><span class=line><span class=cl>‚îÇ   ‚îú‚îÄ‚îÄ sentiment-agent/          # Sentiment analysis
</span></span><span class=line><span class=cl>‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ src/sentiment_agent/
</span></span><span class=line><span class=cl>‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ agent.py          # Langchain agent
</span></span><span class=line><span class=cl>‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ tools.py          # News collection / Sentiment Analysis
</span></span><span class=line><span class=cl>‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ server.py         # A2A endpoint
</span></span><span class=line><span class=cl>‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ pyproject.toml
</span></span><span class=line><span class=cl>‚îÇ   ‚îî‚îÄ‚îÄ valuation-agent/          # Quantitative analysis
</span></span><span class=line><span class=cl>‚îÇ       ‚îî‚îÄ‚îÄ src/valuation_agent/
</span></span><span class=line><span class=cl>‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ agent.py          # Langchain agent
</span></span><span class=line><span class=cl>‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ tools.py          # Stock data collection / KPI calculation
</span></span><span class=line><span class=cl>‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ server.py         # A2A endpoint
</span></span><span class=line><span class=cl>‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ pyproject.toml</span></span></code></pre></div></div><h2 id=53-group-chat-agent-implementation>5.3 Group Chat Agent Implementation</h2><p>The <strong>Group Chat Agent</strong> is the heart and entry point of the system, implemented in the <code>A2AGroupChatAgent</code> class. Its main responsibilities include:</p><ol><li><strong>Intelligent debate detection</strong>: Uses LLM to determine if the query requires structured debate</li><li><strong>Automatic risk tolerance inference</strong>: Analyzes user message to identify risk profile</li><li><strong>Multilingual routing</strong>: Identifies necessary agents regardless of query language</li><li><strong>Debate orchestration</strong>: Manages fair participation through a round-robin turn system</li><li><strong>Consensus monitoring</strong>: Verifies agreement and terminates debate when appropriate</li><li><strong>Metadata enhancement</strong>: Automatically enriches metadata with risk_tolerance for all agents</li></ol><h3 id=531-risk-tolerance-inference>5.3.1 Risk Tolerance Inference</h3><p>The system uses an <strong>LLM-based classifier</strong> that analyzes the user&rsquo;s message to infer the risk profile. The classification guidelines include:</p><ol><li><strong>Explicit risk preferences</strong>: Terms like &ldquo;conservative,&rdquo; &ldquo;aggressive,&rdquo; &ldquo;high growth,&rdquo; &ldquo;safe,&rdquo; &ldquo;stable&rdquo;</li><li><strong>Investment timeframe</strong>: Mentions of &ldquo;retirement,&rdquo; &ldquo;long term,&rdquo; &ldquo;quick gains&rdquo;</li><li><strong>Vocabulary analysis</strong>: Linguistic choices and tone (cautious vs confident vs speculative)</li><li><strong>Asset types mentioned</strong>: Bonds/dividends = averse, growth stock = seeking</li><li><strong>Multilingual support</strong>: Works in any language by analyzing intent and risk signals</li></ol><p>As I anticipated earlier, I have no idea how the BlackRock researchers identified the risk profile. However, it&rsquo;s easy to imagine they did something similar.</p><h3 id=532-code-excerpt>5.3.2 Code Excerpt</h3><p>Below is an excerpt from the <code>A2AGroupChatAgent</code> class illustrating some of the main methods:</p><div class="code-block code-line-numbers" style="counter-reset:code-block 0"><div class="code-header language-python"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>A2AGroupChatAgent</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>openai_api_key</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>registry_url</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>model_name</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&#34;gpt-4o&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>llm</span> <span class=o>=</span> <span class=n>ChatOpenAI</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>model</span><span class=o>=</span><span class=n>model_name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>openai_api_key</span><span class=o>=</span><span class=n>openai_api_key</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>temperature</span><span class=o>=</span><span class=mf>0.1</span>  <span class=c1># Low temperature for financial analysis</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>registry_service</span> <span class=o>=</span> <span class=n>AgentRegistryService</span><span class=p>(</span><span class=n>registry_url</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>_agent_urls</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_requires_debate_analysis</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>user_message</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;Uses LLM to intelligently determine if structured debate is needed.&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>system_prompt</span> <span class=o>=</span> <span class=s2>&#34;&#34;&#34;You are a debate necessity classifier for a multi-agent financial analysis system.
</span></span></span><span class=line><span class=cl><span class=s2>        
</span></span></span><span class=line><span class=cl><span class=s2>        STRUCTURED DEBATE IS NEEDED when:
</span></span></span><span class=line><span class=cl><span class=s2>        1. The query asks for investment decisions or recommendations (buy/sell/hold advice)
</span></span></span><span class=line><span class=cl><span class=s2>        2. The query requires weighing conflicting factors or multiple perspectives
</span></span></span><span class=line><span class=cl><span class=s2>        3. The query asks for comprehensive analysis that would benefit from specialist disagreement/consensus
</span></span></span><span class=line><span class=cl><span class=s2>        4. The query involves risk assessment or strategic financial decisions
</span></span></span><span class=line><span class=cl><span class=s2>        5. The query asks for opinions, advice, or evaluations that could have multiple valid perspectives
</span></span></span><span class=line><span class=cl><span class=s2>        6. The query involves portfolio management decisions
</span></span></span><span class=line><span class=cl><span class=s2>        
</span></span></span><span class=line><span class=cl><span class=s2>        The query can be in ANY language. Focus on the intent and meaning, not specific keywords.
</span></span></span><span class=line><span class=cl><span class=s2>        Respond with ONLY &#34;YES&#34; if structured debate is needed, or &#34;NO&#34; if it&#39;s not needed.&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>response</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>llm</span><span class=o>.</span><span class=n>invoke</span><span class=p>([</span>
</span></span><span class=line><span class=cl>            <span class=n>SystemMessage</span><span class=p>(</span><span class=n>content</span><span class=o>=</span><span class=n>system_prompt</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>HumanMessage</span><span class=p>(</span><span class=n>content</span><span class=o>=</span><span class=sa>f</span><span class=s2>&#34;User query: </span><span class=si>{</span><span class=n>user_message</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>])</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>response</span><span class=o>.</span><span class=n>content</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span><span class=o>.</span><span class=n>upper</span><span class=p>()</span> <span class=o>==</span> <span class=s2>&#34;YES&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_enhance_metadata_with_risk_tolerance</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=p>,</span> <span class=n>user_message</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>metadata</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;Extract or infer risk tolerance and add it to metadata.&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>enhanced_metadata</span> <span class=o>=</span> <span class=n>metadata</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span> <span class=k>if</span> <span class=n>metadata</span> <span class=k>else</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># If risk_tolerance already provided in metadata, use it</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=s2>&#34;risk_tolerance&#34;</span> <span class=ow>in</span> <span class=n>enhanced_metadata</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Using provided risk_tolerance: </span><span class=si>{</span><span class=n>enhanced_metadata</span><span class=p>[</span><span class=s1>&#39;risk_tolerance&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>enhanced_metadata</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># Otherwise, infer using LLM</span>
</span></span><span class=line><span class=cl>        <span class=n>risk_tolerance</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_infer_risk_tolerance_from_message</span><span class=p>(</span><span class=n>user_message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>enhanced_metadata</span><span class=p>[</span><span class=s2>&#34;risk_tolerance&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=n>risk_tolerance</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Inferred risk_tolerance: </span><span class=si>{</span><span class=n>risk_tolerance</span><span class=si>}</span><span class=s2> from user message&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>enhanced_metadata</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_infer_risk_tolerance_from_message</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>user_message</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;Use LLM to infer risk tolerance from user message content.&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>system_prompt</span> <span class=o>=</span> <span class=s2>&#34;&#34;&#34;You are a financial risk tolerance classifier. 
</span></span></span><span class=line><span class=cl><span class=s2>        Analyze the user&#39;s message to determine their risk tolerance profile.
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>        RISK TOLERANCE LEVELS:
</span></span></span><span class=line><span class=cl><span class=s2>        - &#34;averse&#34;: Conservative investors (capital preservation, stable returns, dividends)
</span></span></span><span class=line><span class=cl><span class=s2>        - &#34;neutral&#34;: Balanced investors (moderate growth with reasonable risk)  
</span></span></span><span class=line><span class=cl><span class=s2>        - &#34;seeking&#34;: Aggressive investors (high returns, accept high volatility)
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>        CLASSIFICATION GUIDELINES:
</span></span></span><span class=line><span class=cl><span class=s2>        1. Look for explicit risk preferences (&#34;conservative&#34;, &#34;aggressive&#34;, &#34;safe&#34;)
</span></span></span><span class=line><span class=cl><span class=s2>        2. Consider investment timeframe (&#34;retirement&#34;, &#34;long-term&#34;, &#34;quick gains&#34;)
</span></span></span><span class=line><span class=cl><span class=s2>        3. Analyze vocabulary and tone (cautious vs confident vs speculative)
</span></span></span><span class=line><span class=cl><span class=s2>        4. Consider asset mentions (bonds/dividends = averse, growth stocks = seeking)
</span></span></span><span class=line><span class=cl><span class=s2>        
</span></span></span><span class=line><span class=cl><span class=s2>        The message can be in any language. Focus on intent and risk signals.
</span></span></span><span class=line><span class=cl><span class=s2>        Respond with ONLY one word: &#34;averse&#34;, &#34;neutral&#34;, or &#34;seeking&#34;.&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>response</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>llm</span><span class=o>.</span><span class=n>invoke</span><span class=p>([</span>
</span></span><span class=line><span class=cl>                <span class=n>SystemMessage</span><span class=p>(</span><span class=n>content</span><span class=o>=</span><span class=n>system_prompt</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                <span class=n>HumanMessage</span><span class=p>(</span><span class=n>content</span><span class=o>=</span><span class=sa>f</span><span class=s2>&#34;User message: </span><span class=si>{</span><span class=n>user_message</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>])</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=n>risk_level</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>content</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>risk_level</span> <span class=k>if</span> <span class=n>risk_level</span> <span class=ow>in</span> <span class=p>[</span><span class=s2>&#34;averse&#34;</span><span class=p>,</span> <span class=s2>&#34;neutral&#34;</span><span class=p>,</span> <span class=s2>&#34;seeking&#34;</span><span class=p>]</span> <span class=k>else</span> <span class=s2>&#34;neutral&#34;</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Error inferring risk tolerance: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=s2>&#34;neutral&#34;</span>  <span class=c1># Safe default</span></span></span></code></pre></div></div><h2 id=54-a2a-communication-patterns>5.4 A2A Communication Patterns</h2><p>Every communication between agents follows the A2A protocol using JSON-RPC:</p><div class="code-block code-line-numbers" style="counter-reset:code-block 0"><div class="code-header language-python"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>_send_message_to_agent</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=bp>self</span><span class=p>,</span> <span class=n>agent_name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>agent_url</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=n>message</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>],</span> <span class=n>metadata</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;Send A2A-compliant message to specialized agents.&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>request_payload</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;jsonrpc&#34;</span><span class=p>:</span> <span class=s2>&#34;2.0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;method&#34;</span><span class=p>:</span> <span class=s2>&#34;message/send&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;params&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;message&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;kind&#34;</span><span class=p>:</span> <span class=s2>&#34;message&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;messageId&#34;</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=n>uuid</span><span class=o>.</span><span class=n>uuid4</span><span class=p>()),</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;role&#34;</span><span class=p>:</span> <span class=s2>&#34;user&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                <span class=s2>&#34;parts&#34;</span><span class=p>:</span> <span class=p>[{</span><span class=s2>&#34;kind&#34;</span><span class=p>:</span> <span class=s2>&#34;text&#34;</span><span class=p>,</span> <span class=s2>&#34;text&#34;</span><span class=p>:</span> <span class=n>user_message</span><span class=p>}],</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;contextId&#34;</span><span class=p>:</span> <span class=n>context_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;taskId&#34;</span><span class=p>:</span> <span class=n>task_id</span>
</span></span><span class=line><span class=cl>            <span class=p>},</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;metadata&#34;</span><span class=p>:</span> <span class=n>metadata</span> <span class=ow>or</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;id&#34;</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=n>uuid</span><span class=o>.</span><span class=n>uuid4</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>with</span> <span class=n>aiohttp</span><span class=o>.</span><span class=n>ClientSession</span><span class=p>(</span><span class=n>timeout</span><span class=o>=</span><span class=n>aiohttp</span><span class=o>.</span><span class=n>ClientTimeout</span><span class=p>(</span><span class=n>total</span><span class=o>=</span><span class=mf>300.0</span><span class=p>))</span> <span class=k>as</span> <span class=n>session</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>async</span> <span class=k>with</span> <span class=n>session</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>agent_url</span><span class=p>,</span> <span class=n>json</span><span class=o>=</span><span class=n>request_payload</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                              <span class=n>headers</span><span class=o>=</span><span class=p>{</span><span class=s2>&#34;Content-Type&#34;</span><span class=p>:</span> <span class=s2>&#34;application/json&#34;</span><span class=p>})</span> <span class=k>as</span> <span class=n>response</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>result</span> <span class=o>=</span> <span class=k>await</span> <span class=n>response</span><span class=o>.</span><span class=n>json</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># Extract content from A2A response</span>
</span></span><span class=line><span class=cl>            <span class=n>a2a_result</span> <span class=o>=</span> <span class=n>result</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;result&#34;</span><span class=p>,</span> <span class=p>{})</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>a2a_result</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;kind&#34;</span><span class=p>)</span> <span class=o>==</span> <span class=s2>&#34;message&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>parts</span> <span class=o>=</span> <span class=n>a2a_result</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;parts&#34;</span><span class=p>,</span> <span class=p>[])</span>
</span></span><span class=line><span class=cl>                <span class=n>analysis</span> <span class=o>=</span> <span class=s2>&#34; &#34;</span><span class=o>.</span><span class=n>join</span><span class=p>([</span><span class=n>p</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;text&#34;</span><span class=p>,</span> <span class=s2>&#34;&#34;</span><span class=p>)</span> <span class=k>for</span> <span class=n>p</span> <span class=ow>in</span> <span class=n>parts</span> 
</span></span><span class=line><span class=cl>                                   <span class=k>if</span> <span class=n>p</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;kind&#34;</span><span class=p>)</span> <span class=o>==</span> <span class=s2>&#34;text&#34;</span><span class=p>])</span></span></span></code></pre></div></div><h2 id=55-specialized-agent-implementation>5.5 Specialized Agent Implementation</h2><h3 id=551-fundamental-agent>5.5.1 Fundamental Agent</h3><p>The Fundamental Agent uses <strong>Langchain</strong> with <strong>tool calling</strong> pattern to access financial data:</p><div class="code-block code-line-numbers" style="counter-reset:code-block 0"><div class="code-header language-python"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>FundamentalAgent</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>openai_api_key</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>model_name</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&#34;gpt-4o&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>llm</span> <span class=o>=</span> <span class=n>ChatOpenAI</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>api_key</span><span class=o>=</span><span class=n>openai_api_key</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>model</span><span class=o>=</span><span class=n>model_name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>temperature</span><span class=o>=</span><span class=mf>0.1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>max_tokens</span><span class=o>=</span><span class=mi>4000</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># Specialized tools for fundamental analysis</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>tools</span> <span class=o>=</span> <span class=n>get_fundamental_tools</span><span class=p>()</span>  <span class=c1># Yahoo Finance API, keyword-based analysis</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># Specialized prompt for fundamental analysis</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>system_prompt</span> <span class=o>=</span> <span class=s2>&#34;&#34;&#34;You are a specialized Fundamental Analysis Agent.
</span></span></span><span class=line><span class=cl><span class=s2>        Your core expertise includes:
</span></span></span><span class=line><span class=cl><span class=s2>        
</span></span></span><span class=line><span class=cl><span class=s2>        **Financial Statement Analysis:**
</span></span></span><span class=line><span class=cl><span class=s2>        - Deep analysis of income statements, balance sheets, and cash flow statements
</span></span></span><span class=line><span class=cl><span class=s2>        - Assessment of financial health, profitability, and operational efficiency
</span></span></span><span class=line><span class=cl><span class=s2>        
</span></span></span><span class=line><span class=cl><span class=s2>        **SEC Filing Analysis:**  
</span></span></span><span class=line><span class=cl><span class=s2>        - Comprehensive review of 10-K and 10-Q reports
</span></span></span><span class=line><span class=cl><span class=s2>        - Management Discussion &amp; Analysis (MD&amp;A) insights
</span></span></span><span class=line><span class=cl><span class=s2>        
</span></span></span><span class=line><span class=cl><span class=s2>        **Investment Decision Framework:**
</span></span></span><span class=line><span class=cl><span class=s2>        Your analysis should result in clear BUY/SELL/HOLD recommendations with:
</span></span></span><span class=line><span class=cl><span class=s2>        - Target price estimates with supporting rationale
</span></span></span><span class=line><span class=cl><span class=s2>        - Risk assessment (financial, operational, market risks)&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># Langchain Agent Executor</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>agent_executor</span> <span class=o>=</span> <span class=n>AgentExecutor</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>agent</span><span class=o>=</span><span class=n>create_openai_tools_agent</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>llm</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>tools</span><span class=p>,</span> <span class=n>prompt</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>tools</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>tools</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>verbose</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>handle_parsing_errors</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>max_iterations</span><span class=o>=</span><span class=mi>10</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span></span></span></code></pre></div></div><h3 id=552-sentiment-agent---vader-implementation>5.5.2 Sentiment Agent - VADER Implementation</h3><p>The Sentiment Agent uses a combination of <strong>VADER</strong> (Valence Aware Dictionary and sEntiment Reasoner) and <strong>TextBlob</strong> to analyze financial news sentiment:</p><div class="code-block code-line-numbers" style="counter-reset:code-block 0"><div class="code-header language-python"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>NewsSummarizationTool</span><span class=p>(</span><span class=n>BaseTool</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>name</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&#34;analyze_news_sentiment&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>description</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&#34;Analyzes financial news sentiment using VADER and TextBlob&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_analyze_vader_sentiment</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>text</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;Analyze sentiment using VADER - optimized for social media and news.&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>vader_analyzer</span> <span class=o>=</span> <span class=n>SentimentIntensityAnalyzer</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>scores</span> <span class=o>=</span> <span class=n>vader_analyzer</span><span class=o>.</span><span class=n>polarity_scores</span><span class=p>(</span><span class=n>text</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># Compound score from -1 to +1</span>
</span></span><span class=line><span class=cl>        <span class=n>compound</span> <span class=o>=</span> <span class=n>scores</span><span class=p>[</span><span class=s1>&#39;compound&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>compound</span> <span class=o>&gt;=</span> <span class=mf>0.05</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>label</span> <span class=o>=</span> <span class=s2>&#34;positive&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=n>compound</span> <span class=o>&lt;=</span> <span class=o>-</span><span class=mf>0.05</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>label</span> <span class=o>=</span> <span class=s2>&#34;negative&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>label</span> <span class=o>=</span> <span class=s2>&#34;neutral&#34;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;compound&#34;</span><span class=p>:</span> <span class=nb>float</span><span class=p>(</span><span class=n>compound</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;pos&#34;</span><span class=p>:</span> <span class=nb>float</span><span class=p>(</span><span class=n>scores</span><span class=p>[</span><span class=s1>&#39;pos&#39;</span><span class=p>]),</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;neg&#34;</span><span class=p>:</span> <span class=nb>float</span><span class=p>(</span><span class=n>scores</span><span class=p>[</span><span class=s1>&#39;neg&#39;</span><span class=p>]),</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;neu&#34;</span><span class=p>:</span> <span class=nb>float</span><span class=p>(</span><span class=n>scores</span><span class=p>[</span><span class=s1>&#39;neu&#39;</span><span class=p>]),</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;label&#34;</span><span class=p>:</span> <span class=n>label</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_analyze_textblob_sentiment</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>text</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;Analyze sentiment using TextBlob.&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>blob</span> <span class=o>=</span> <span class=n>TextBlob</span><span class=p>(</span><span class=n>text</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>polarity</span> <span class=o>=</span> <span class=n>blob</span><span class=o>.</span><span class=n>sentiment</span><span class=o>.</span><span class=n>polarity</span>  <span class=c1># -1 to 1</span>
</span></span><span class=line><span class=cl>        <span class=n>subjectivity</span> <span class=o>=</span> <span class=n>blob</span><span class=o>.</span><span class=n>sentiment</span><span class=o>.</span><span class=n>subjectivity</span>  <span class=c1># 0 to 1</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>polarity</span> <span class=o>&gt;</span> <span class=mf>0.1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>label</span> <span class=o>=</span> <span class=s2>&#34;positive&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=n>polarity</span> <span class=o>&lt;</span> <span class=o>-</span><span class=mf>0.1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>label</span> <span class=o>=</span> <span class=s2>&#34;negative&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>label</span> <span class=o>=</span> <span class=s2>&#34;neutral&#34;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;polarity&#34;</span><span class=p>:</span> <span class=nb>float</span><span class=p>(</span><span class=n>polarity</span><span class=p>),</span> <span class=s2>&#34;subjectivity&#34;</span><span class=p>:</span> <span class=nb>float</span><span class=p>(</span><span class=n>subjectivity</span><span class=p>),</span> <span class=s2>&#34;label&#34;</span><span class=p>:</span> <span class=n>label</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_combine_sentiments</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>textblob</span><span class=p>:</span> <span class=n>Dict</span><span class=p>,</span> <span class=n>vader</span><span class=p>:</span> <span class=n>Dict</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;Combine results with higher weight for VADER (better for news).&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>combined_score</span> <span class=o>=</span> <span class=p>(</span><span class=n>textblob</span><span class=p>[</span><span class=s2>&#34;polarity&#34;</span><span class=p>]</span> <span class=o>*</span> <span class=mf>0.4</span><span class=p>)</span> <span class=o>+</span> <span class=p>(</span><span class=n>vader</span><span class=p>[</span><span class=s2>&#34;compound&#34;</span><span class=p>]</span> <span class=o>*</span> <span class=mf>0.6</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>combined_score</span> <span class=o>&gt;</span> <span class=mf>0.1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>label</span> <span class=o>=</span> <span class=s2>&#34;positive&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=n>combined_score</span> <span class=o>&lt;</span> <span class=o>-</span><span class=mf>0.1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>label</span> <span class=o>=</span> <span class=s2>&#34;negative&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>label</span> <span class=o>=</span> <span class=s2>&#34;neutral&#34;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;score&#34;</span><span class=p>:</span> <span class=nb>float</span><span class=p>(</span><span class=n>combined_score</span><span class=p>),</span> <span class=s2>&#34;label&#34;</span><span class=p>:</span> <span class=n>label</span><span class=p>,</span> <span class=s2>&#34;confidence&#34;</span><span class=p>:</span> <span class=nb>abs</span><span class=p>(</span><span class=n>combined_score</span><span class=p>)}</span></span></span></code></pre></div></div><h3 id=553-fundamental-agent---keyword-based-implementation>5.5.3 Fundamental Agent - Keyword-Based Implementation</h3><p>The fundamental analysis <strong>does not use RAG techniques</strong>, but employs a very elementary approach based on <strong>keyword matching</strong> starting from the metadata returned by Yahoo Finance:</p><div class="code-block code-line-numbers" style="counter-reset:code-block 0"><div class="code-header language-python"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>RAGAnalysisTool</span><span class=p>(</span><span class=n>BaseTool</span><span class=p>):</span>  <span class=c1># Name kept for compatibility and future evolution, but NOT true RAG</span>
</span></span><span class=line><span class=cl>    <span class=n>name</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&#34;rag_fundamental_analysis&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>description</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&#34;Performs fundamental analysis using keyword-based data extraction&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_find_cash_flow_key</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>data</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>],</span> <span class=n>possible_keys</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;Find correct key for cash flow data using pattern matching.&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>item_name</span><span class=p>,</span> <span class=n>_</span> <span class=ow>in</span> <span class=n>data</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>key</span> <span class=ow>in</span> <span class=n>possible_keys</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>key</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span> <span class=ow>in</span> <span class=n>item_name</span><span class=o>.</span><span class=n>lower</span><span class=p>():</span>
</span></span><span class=line><span class=cl>                    <span class=k>return</span> <span class=n>item_name</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_analyze_cash_flow</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>financial_context</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>],</span> <span class=n>guidance</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;Analyze cash flow with keyword search, not RAG.&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>quarterly_data</span> <span class=o>=</span> <span class=n>financial_context</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;cash_flow&#34;</span><span class=p>,</span> <span class=p>{})</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;quarterly&#34;</span><span class=p>,</span> <span class=p>{})</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;data&#34;</span><span class=p>,</span> <span class=p>{})</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>quarterly_data</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># Search for &#34;Operating Cash Flow&#34; using keyword matching</span>
</span></span><span class=line><span class=cl>            <span class=n>operating_cf_key</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_find_cash_flow_key</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=n>quarterly_data</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                <span class=p>[</span><span class=s2>&#34;Operating Cash Flow&#34;</span><span class=p>,</span> <span class=s2>&#34;Total Cash From Operating Activities&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>operating_cf_key</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=c1># Extract values using found pattern</span>
</span></span><span class=line><span class=cl>                <span class=n>cf_values</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>                <span class=k>for</span> <span class=n>period</span><span class=p>,</span> <span class=n>values</span> <span class=ow>in</span> <span class=n>quarterly_data</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span></span><span class=line><span class=cl>                    <span class=k>if</span> <span class=n>operating_cf_key</span> <span class=ow>in</span> <span class=n>values</span> <span class=ow>and</span> <span class=n>values</span><span class=p>[</span><span class=n>operating_cf_key</span><span class=p>]</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=n>cf_values</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>values</span><span class=p>[</span><span class=n>operating_cf_key</span><span class=p>])</span></span></span></code></pre></div></div><h3 id=554-valuation-agent-tools>5.5.4 Valuation Agent Tools</h3><p>The Valuation Agent implements specialized financial calculations using <strong>pandas</strong> and <strong>numpy</strong>:</p><div class="code-block code-line-numbers" style="counter-reset:code-block 0"><div class="code-header language-python"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>VolatilityCalculationTool</span><span class=p>(</span><span class=n>BaseTool</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>name</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&#34;calculate_volatility_metrics&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>description</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&#34;Calculates comprehensive volatility and risk metrics&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_run</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>symbol</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>risk_free_rate</span><span class=p>:</span> <span class=nb>float</span> <span class=o>=</span> <span class=mf>0.05</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;Calculate volatility and risk metrics synchronously.&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># First fetch the data</span>
</span></span><span class=line><span class=cl>            <span class=n>stock_tool</span> <span class=o>=</span> <span class=n>StockDataTool</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=n>stock_data</span> <span class=o>=</span> <span class=n>stock_tool</span><span class=o>.</span><span class=n>_run</span><span class=p>(</span><span class=n>symbol</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=ow>not</span> <span class=n>stock_data</span><span class=p>[</span><span class=s2>&#34;success&#34;</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=n>stock_data</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># Convert to pandas DataFrame for calculations</span>
</span></span><span class=line><span class=cl>            <span class=n>price_data</span> <span class=o>=</span> <span class=n>stock_data</span><span class=p>[</span><span class=s2>&#34;price_data&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=n>df</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>({</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;Date&#39;</span><span class=p>:</span> <span class=n>pd</span><span class=o>.</span><span class=n>to_datetime</span><span class=p>(</span><span class=n>price_data</span><span class=p>[</span><span class=s2>&#34;dates&#34;</span><span class=p>]),</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;Close&#39;</span><span class=p>:</span> <span class=n>price_data</span><span class=p>[</span><span class=s2>&#34;close&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;Volume&#39;</span><span class=p>:</span> <span class=n>price_data</span><span class=p>[</span><span class=s2>&#34;volume&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=p>})</span>
</span></span><span class=line><span class=cl>            <span class=n>df</span><span class=o>.</span><span class=n>set_index</span><span class=p>(</span><span class=s1>&#39;Date&#39;</span><span class=p>,</span> <span class=n>inplace</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># Calculate daily returns</span>
</span></span><span class=line><span class=cl>            <span class=n>df</span><span class=p>[</span><span class=s1>&#39;Daily_Return&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>df</span><span class=p>[</span><span class=s1>&#39;Close&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>pct_change</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=n>df</span> <span class=o>=</span> <span class=n>df</span><span class=o>.</span><span class=n>dropna</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>df</span><span class=p>)</span> <span class=o>&lt;</span> <span class=mi>2</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;success&#34;</span><span class=p>:</span> <span class=kc>False</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;error&#34;</span><span class=p>:</span> <span class=s2>&#34;Insufficient data for calculations&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;symbol&#34;</span><span class=p>:</span> <span class=n>symbol</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># Basic metrics</span>
</span></span><span class=line><span class=cl>            <span class=n>daily_returns</span> <span class=o>=</span> <span class=n>df</span><span class=p>[</span><span class=s1>&#39;Daily_Return&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># Daily metrics</span>
</span></span><span class=line><span class=cl>            <span class=n>mean_daily_return</span> <span class=o>=</span> <span class=n>daily_returns</span><span class=o>.</span><span class=n>mean</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=n>daily_volatility</span> <span class=o>=</span> <span class=n>daily_returns</span><span class=o>.</span><span class=n>std</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># Calculate cumulative return for proper annualized return</span>
</span></span><span class=line><span class=cl>            <span class=n>start_price</span> <span class=o>=</span> <span class=n>df</span><span class=p>[</span><span class=s1>&#39;Close&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=n>end_price</span> <span class=o>=</span> <span class=n>df</span><span class=p>[</span><span class=s1>&#39;Close&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=n>cumulative_return</span> <span class=o>=</span> <span class=p>(</span><span class=n>end_price</span> <span class=o>/</span> <span class=n>start_price</span><span class=p>)</span> <span class=o>-</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>            <span class=n>trading_days</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>df</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># Annualized metrics</span>
</span></span><span class=line><span class=cl>            <span class=n>annualized_return</span> <span class=o>=</span> <span class=p>((</span><span class=mi>1</span> <span class=o>+</span> <span class=n>cumulative_return</span><span class=p>)</span> <span class=o>**</span> <span class=p>(</span><span class=n>TRADING_DAYS_PER_YEAR</span> <span class=o>/</span> <span class=n>trading_days</span><span class=p>))</span> <span class=o>-</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>            <span class=n>annualized_volatility</span> <span class=o>=</span> <span class=n>daily_volatility</span> <span class=o>*</span> <span class=n>np</span><span class=o>.</span><span class=n>sqrt</span><span class=p>(</span><span class=n>TRADING_DAYS_PER_YEAR</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># Sharpe ratio</span>
</span></span><span class=line><span class=cl>            <span class=n>sharpe_ratio</span> <span class=o>=</span> <span class=p>(</span><span class=n>annualized_return</span> <span class=o>-</span> <span class=n>risk_free_rate</span><span class=p>)</span> <span class=o>/</span> <span class=n>annualized_volatility</span> <span class=k>if</span> <span class=n>annualized_volatility</span> <span class=o>&gt;</span> <span class=mi>0</span> <span class=k>else</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># Maximum drawdown calculation</span>
</span></span><span class=line><span class=cl>            <span class=n>cumulative_returns</span> <span class=o>=</span> <span class=p>(</span><span class=mi>1</span> <span class=o>+</span> <span class=n>daily_returns</span><span class=p>)</span><span class=o>.</span><span class=n>cumprod</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=n>rolling_max</span> <span class=o>=</span> <span class=n>cumulative_returns</span><span class=o>.</span><span class=n>expanding</span><span class=p>()</span><span class=o>.</span><span class=n>max</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=n>drawdowns</span> <span class=o>=</span> <span class=p>(</span><span class=n>cumulative_returns</span> <span class=o>-</span> <span class=n>rolling_max</span><span class=p>)</span> <span class=o>/</span> <span class=n>rolling_max</span>
</span></span><span class=line><span class=cl>            <span class=n>max_drawdown</span> <span class=o>=</span> <span class=n>drawdowns</span><span class=o>.</span><span class=n>min</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># Value at Risk (VaR) - 5% and 1%</span>
</span></span><span class=line><span class=cl>            <span class=n>var_5</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>percentile</span><span class=p>(</span><span class=n>daily_returns</span><span class=p>,</span> <span class=mi>5</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>var_1</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>percentile</span><span class=p>(</span><span class=n>daily_returns</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># Additional statistics</span>
</span></span><span class=line><span class=cl>            <span class=n>skewness</span> <span class=o>=</span> <span class=n>daily_returns</span><span class=o>.</span><span class=n>skew</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=n>kurtosis</span> <span class=o>=</span> <span class=n>daily_returns</span><span class=o>.</span><span class=n>kurtosis</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># Price performance metrics</span>
</span></span><span class=line><span class=cl>            <span class=n>total_return</span> <span class=o>=</span> <span class=p>(</span><span class=n>df</span><span class=p>[</span><span class=s1>&#39;Close&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span> <span class=o>-</span> <span class=n>df</span><span class=p>[</span><span class=s1>&#39;Close&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span> <span class=o>/</span> <span class=n>df</span><span class=p>[</span><span class=s1>&#39;Close&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=n>result</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;success&#34;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;symbol&#34;</span><span class=p>:</span> <span class=n>symbol</span><span class=o>.</span><span class=n>upper</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;analysis_period&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;start_date&#34;</span><span class=p>:</span> <span class=n>df</span><span class=o>.</span><span class=n>index</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>strftime</span><span class=p>(</span><span class=s2>&#34;%Y-%m-</span><span class=si>%d</span><span class=s2>&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;end_date&#34;</span><span class=p>:</span> <span class=n>df</span><span class=o>.</span><span class=n>index</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>strftime</span><span class=p>(</span><span class=s2>&#34;%Y-%m-</span><span class=si>%d</span><span class=s2>&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;trading_days&#34;</span><span class=p>:</span> <span class=nb>len</span><span class=p>(</span><span class=n>df</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=p>},</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;price_metrics&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;start_price&#34;</span><span class=p>:</span> <span class=nb>float</span><span class=p>(</span><span class=n>df</span><span class=p>[</span><span class=s1>&#39;Close&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=mi>0</span><span class=p>]),</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;end_price&#34;</span><span class=p>:</span> <span class=nb>float</span><span class=p>(</span><span class=n>df</span><span class=p>[</span><span class=s1>&#39;Close&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]),</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;total_return&#34;</span><span class=p>:</span> <span class=nb>float</span><span class=p>(</span><span class=n>total_return</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;annualized_return&#34;</span><span class=p>:</span> <span class=nb>float</span><span class=p>(</span><span class=n>annualized_return</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=p>},</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;volatility_metrics&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;daily_volatility&#34;</span><span class=p>:</span> <span class=nb>float</span><span class=p>(</span><span class=n>daily_volatility</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;annualized_volatility&#34;</span><span class=p>:</span> <span class=nb>float</span><span class=p>(</span><span class=n>annualized_volatility</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;volatility_percentage&#34;</span><span class=p>:</span> <span class=nb>float</span><span class=p>(</span><span class=n>annualized_volatility</span> <span class=o>*</span> <span class=mi>100</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=p>},</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;risk_metrics&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;sharpe_ratio&#34;</span><span class=p>:</span> <span class=nb>float</span><span class=p>(</span><span class=n>sharpe_ratio</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;max_drawdown&#34;</span><span class=p>:</span> <span class=nb>float</span><span class=p>(</span><span class=n>max_drawdown</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;max_drawdown_percentage&#34;</span><span class=p>:</span> <span class=nb>float</span><span class=p>(</span><span class=n>max_drawdown</span> <span class=o>*</span> <span class=mi>100</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;var_5_percent&#34;</span><span class=p>:</span> <span class=nb>float</span><span class=p>(</span><span class=n>var_5</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;var_1_percent&#34;</span><span class=p>:</span> <span class=nb>float</span><span class=p>(</span><span class=n>var_1</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;risk_free_rate&#34;</span><span class=p>:</span> <span class=nb>float</span><span class=p>(</span><span class=n>risk_free_rate</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=p>},</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;distribution_metrics&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;mean_daily_return&#34;</span><span class=p>:</span> <span class=nb>float</span><span class=p>(</span><span class=n>mean_daily_return</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;skewness&#34;</span><span class=p>:</span> <span class=nb>float</span><span class=p>(</span><span class=n>skewness</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;kurtosis&#34;</span><span class=p>:</span> <span class=nb>float</span><span class=p>(</span><span class=n>kurtosis</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;positive_days&#34;</span><span class=p>:</span> <span class=nb>int</span><span class=p>((</span><span class=n>daily_returns</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span><span class=o>.</span><span class=n>sum</span><span class=p>()),</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;negative_days&#34;</span><span class=p>:</span> <span class=nb>int</span><span class=p>((</span><span class=n>daily_returns</span> <span class=o>&lt;</span> <span class=mi>0</span><span class=p>)</span><span class=o>.</span><span class=n>sum</span><span class=p>())</span>
</span></span><span class=line><span class=cl>                <span class=p>},</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;volume_metrics&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;average_volume&#34;</span><span class=p>:</span> <span class=nb>float</span><span class=p>(</span><span class=n>df</span><span class=p>[</span><span class=s1>&#39;Volume&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>mean</span><span class=p>()),</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;volume_volatility&#34;</span><span class=p>:</span> <span class=nb>float</span><span class=p>(</span><span class=n>df</span><span class=p>[</span><span class=s1>&#39;Volume&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>std</span><span class=p>()),</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;latest_volume&#34;</span><span class=p>:</span> <span class=nb>float</span><span class=p>(</span><span class=n>df</span><span class=p>[</span><span class=s1>&#39;Volume&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>])</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Successfully calculated metrics for </span><span class=si>{</span><span class=n>symbol</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>result</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Error calculating metrics for </span><span class=si>{</span><span class=n>symbol</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;success&#34;</span><span class=p>:</span> <span class=kc>False</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;error&#34;</span><span class=p>:</span> <span class=sa>f</span><span class=s2>&#34;Failed to calculate metrics for </span><span class=si>{</span><span class=n>symbol</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;symbol&#34;</span><span class=p>:</span> <span class=n>symbol</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span></span></span></code></pre></div></div><h2 id=56-agent-registration-and-discovery>5.6 Agent Registration and Discovery</h2><p>Each agent exposes a <code>/.well-known/agent-card</code> endpoint for automatic discovery. Before launching the entire stack, I used these endpoints for registration within the Agent Registry:</p><div class="code-block code-line-numbers" style="counter-reset:code-block 0"><div class="code-header language-python"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=nd>@app.get</span><span class=p>(</span><span class=s2>&#34;/.well-known/agent-card&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>get_agent_card</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;Valuation Analysis Agent&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;description&#34;</span><span class=p>:</span> <span class=s2>&#34;Specialized agent for stock valuation and technical analysis&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;version&#34;</span><span class=p>:</span> <span class=s2>&#34;1.0.0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;protocolVersion&#34;</span><span class=p>:</span> <span class=s2>&#34;0.3.0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;url&#34;</span><span class=p>:</span> <span class=s2>&#34;http://0.0.0.0:3001/&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;preferredTransport&#34;</span><span class=p>:</span> <span class=s2>&#34;JSONRPC&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;skills&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;id&#34;</span><span class=p>:</span> <span class=s2>&#34;technical_valuation_analysis&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;Technical Valuation Analysis&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;description&#34;</span><span class=p>:</span> <span class=s2>&#34;Comprehensive technical analysis using historical data&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;tags&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;technical-analysis&#34;</span><span class=p>,</span> <span class=s2>&#34;volatility-analysis&#34;</span><span class=p>,</span> <span class=s2>&#34;valuation-metrics&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div></div><h2 id=57-consolidation-pattern-with-llm>5.7 Consolidation Pattern with LLM</h2><p>The consolidation of specialist analyses uses a <strong>meta-prompt</strong> pattern to synthesize different perspectives.</p><div class="code-block code-line-numbers" style="counter-reset:code-block 0"><div class="code-header language-python"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>_consolidate_analyses</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>agent_responses</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>],</span> <span class=n>user_message</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>system_prompt</span> <span class=o>=</span> <span class=s2>&#34;&#34;&#34;You are a financial analysis consolidator. Your role is to 
</span></span></span><span class=line><span class=cl><span class=s2>    synthesize insights from multiple specialist agents into a coherent response.
</span></span></span><span class=line><span class=cl><span class=s2>    
</span></span></span><span class=line><span class=cl><span class=s2>    CONSOLIDATION GUIDELINES:
</span></span></span><span class=line><span class=cl><span class=s2>    1. Integrate insights from all successful agent responses
</span></span></span><span class=line><span class=cl><span class=s2>    2. Identify agreements and disagreements between agents
</span></span></span><span class=line><span class=cl><span class=s2>    3. Provide clear, actionable recommendations when possible
</span></span></span><span class=line><span class=cl><span class=s2>    4. If agents disagree, explain the different perspectives&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>analyses_text</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>response</span> <span class=ow>in</span> <span class=n>successful_responses</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>agent_name</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;agent&#34;</span><span class=p>,</span> <span class=s2>&#34;unknown&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>analysis</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;analysis&#34;</span><span class=p>,</span> <span class=s2>&#34;No analysis provided&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>analyses_text</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;**</span><span class=si>{</span><span class=n>agent_name</span><span class=o>.</span><span class=n>upper</span><span class=p>()</span><span class=si>}</span><span class=s2> AGENT:**</span><span class=se>\n</span><span class=si>{</span><span class=n>analysis</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>consolidation_prompt</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    USER REQUEST: </span><span class=si>{</span><span class=n>user_message</span><span class=si>}</span><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    
</span></span></span><span class=line><span class=cl><span class=s2>    AGENT ANALYSES:
</span></span></span><span class=line><span class=cl><span class=s2>    </span><span class=si>{</span><span class=nb>chr</span><span class=p>(</span><span class=mi>10</span><span class=p>)</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>analyses_text</span><span class=p>)</span><span class=si>}</span><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    
</span></span></span><span class=line><span class=cl><span class=s2>    Please provide a consolidated analysis that synthesizes these perspectives.&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>response</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>llm</span><span class=o>.</span><span class=n>invoke</span><span class=p>([</span>
</span></span><span class=line><span class=cl>        <span class=n>SystemMessage</span><span class=p>(</span><span class=n>content</span><span class=o>=</span><span class=n>system_prompt</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=n>HumanMessage</span><span class=p>(</span><span class=n>content</span><span class=o>=</span><span class=n>consolidation_prompt</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>])</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>response</span><span class=o>.</span><span class=n>content</span></span></span></code></pre></div></div><p>This consolidation solution complements the <strong>structured debate system</strong> implemented: when debate is activated, the final consolidation highlights the collaborative process followed and debate metadata (rounds, turns, participation), while for informational queries it uses standard consolidation to maximize speed and efficiency.</p><h2 id=58-current-implementation-simplifications>5.8 Current Implementation Simplifications</h2><p>It&rsquo;s important to highlight some simplifications I adopted compared to the original paper specifications, to make practical compromises:</p><p><strong>Sentiment Analysis</strong>: The use of VADER and TextBlob is effective for a prototype, but in a production implementation it would be appropriate to evaluate:</p><ul><li>Transformer models specialized for financial text (FinBERT)</li><li>More sophisticated multi-source analysis</li><li>Financial context-specific handling</li></ul><p><strong>Fundamental Analysis</strong>: The keyword-based approach works on structured Yahoo Finance data, but a production implementation would require:</p><ul><li>True RAG system with vector embeddings for SEC documents</li><li>Integration with professional financial databases (Bloomberg, Refinitiv)</li><li>Advanced semantic parsing of 10-K/10-Q documents</li></ul><p><strong>Validation</strong>: The system lacks:</p><ul><li>Rigorous backtesting of recommendations</li><li>Performance metrics validated on historical datasets</li><li>Comparison with market benchmarks</li></ul><p>In view of future evolution, we can easily replace these components with more sophisticated implementations without modifying the overall architecture.</p><h1 id=6-x-ray-scan-of-a-user-request>6. X-Ray Scan of a User Request</h1><p>To understand well how the AlphaAgents system works, let&rsquo;s see it in action!
I performed an end-to-end test using a significant user query that requires the involvement of all three specialized agents.</p><p><strong>User query</strong>: <em>&ldquo;I&rsquo;m undecided whether to invest in Tesla or Palantir. My investment horizon is 5-7 years and I want maximum returns, I can handle high risk&rdquo;</em></p><p>In this section, I will document step by step everything that happens behind the scenes from the moment the request is received by the Group Chat Agent until the generation of the final synthesis report.</p><h2 id=61-phase-1-initialization-and-ecosystem-setup>6.1 Phase 1: Initialization and Ecosystem Setup</h2><p>Before the user query can be processed, it&rsquo;s necessary that the entire AlphaAgents ecosystem is active and operational:</p><h3 id=611-agent-registry-startup>6.1.1 Agent Registry Startup</h3><p>The Agent Registry is the first component that must be activated, as all agents depend on it for discovery:</p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-bash"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Agent Registry active on port 8000</span>
</span></span><span class=line><span class=cl>curl -s http://localhost:8000/health
</span></span><span class=line><span class=cl><span class=c1># Response: {&#34;status&#34;:&#34;ok&#34;,&#34;time&#34;:&#34;2025-08-30T17:06:48.102057+00:00&#34;}</span></span></span></code></pre></div></div><h3 id=612-specialized-agent-startup>6.1.2 Specialized Agent Startup</h3><p>I launched the specialized agents in my local configuration on ports [3001, 3002, 3003]:</p><p><strong>Valuation Agent</strong> (port 3001):</p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-plaintext"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=cl>2025-08-30 19:06:50 - __main__ - INFO - Starting Valuation Agent...
</span></span><span class=line><span class=cl>2025-08-30 19:06:50 - valuation_agent.agent - INFO - Valuation Agent initialized successfully
</span></span><span class=line><span class=cl>2025-08-30 19:06:50 - valuation_agent.server - INFO - A2A Valuation Server initialized on 0.0.0.0:3001
</span></span><span class=line><span class=cl>INFO: Uvicorn running on http://0.0.0.0:3001</span></span></code></pre></div></div><p><strong>Sentiment Agent</strong> (port 3002):</p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-plaintext"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=cl>2025-08-30 19:06:50 - __main__ - INFO - Starting Sentiment Agent...
</span></span><span class=line><span class=cl>2025-08-30 19:06:50 - sentiment_agent.agent - INFO - Sentiment Agent initialized successfully
</span></span><span class=line><span class=cl>2025-08-30 19:06:50 - sentiment_agent.server - INFO - A2A Sentiment Server initialized on 0.0.0.0:3002
</span></span><span class=line><span class=cl>INFO: Uvicorn running on http://0.0.0.0:3002</span></span></code></pre></div></div><p><strong>Fundamental Agent</strong> (port 3003):</p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-plaintext"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=cl>2025-08-30 19:06:50 - __main__ - INFO - Starting Fundamental Agent...
</span></span><span class=line><span class=cl>2025-08-30 19:06:50 - fundamental_agent.agent - INFO - Fundamental Agent initialized successfully
</span></span><span class=line><span class=cl>2025-08-30 19:06:50 - fundamental_agent.server - INFO - A2A Fundamental Server initialized on 0.0.0.0:3003
</span></span><span class=line><span class=cl>INFO: Uvicorn running on http://0.0.0.0:3003</span></span></code></pre></div></div><h3 id=613-group-chat-agent-startup>6.1.3 Group Chat Agent Startup</h3><p>The Group Chat Agent is the last to be started and acts as orchestrator:</p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-plaintext"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=cl>2025-08-30 19:07:31 - groupchat_agent.server - INFO - Starting GroupChat Agent server on 0.0.0.0:3000
</span></span><span class=line><span class=cl>2025-08-30 19:07:31 - groupchat_agent.a2a_agent - INFO - A2A GroupChat Agent initialized successfully
</span></span><span class=line><span class=cl>INFO: Uvicorn running on http://0.0.0.0:3000</span></span></code></pre></div></div><h2 id=62-phase-2-query-reception-and-parsing>6.2 Phase 2: Query Reception and Parsing</h2><h3 id=621-json-rpc-a2a-request>6.2.1 JSON-RPC A2A Request</h3><p>The user query is sent to the Group Chat Agent via JSON-RPC protocol:</p><div class="code-block code-line-numbers" style="counter-reset:code-block 0"><div class="code-header language-json"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;jsonrpc&#34;</span><span class=p>:</span> <span class=s2>&#34;2.0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;method&#34;</span><span class=p>:</span> <span class=s2>&#34;message/send&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;params&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;message&#34;</span><span class=p>:</span> <span class=s2>&#34;I&#39;m undecided whether to invest in Tesla or Palantir. My investment horizon is 5-7 years and I want maximum returns, I can handle high risk&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;metadata&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;user_id&#34;</span><span class=p>:</span> <span class=s2>&#34;demo_user&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>      <span class=nt>&#34;session_id&#34;</span><span class=p>:</span> <span class=s2>&#34;demo_session&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;id&#34;</span><span class=p>:</span> <span class=s2>&#34;1&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div><h3 id=622-conversion-to-a2a-message-format>6.2.2 Conversion to A2A Message Format</h3><p>The server automatically converts the query into standard A2A Message format:</p><div class="code-block code-line-numbers" style="counter-reset:code-block 0"><div class="code-header language-json"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;kind&#34;</span><span class=p>:</span> <span class=s2>&#34;message&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;messageId&#34;</span><span class=p>:</span> <span class=s2>&#34;uuid-generated&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;role&#34;</span><span class=p>:</span> <span class=s2>&#34;user&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>  <span class=nt>&#34;parts&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;kind&#34;</span><span class=p>:</span> <span class=s2>&#34;text&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;text&#34;</span><span class=p>:</span> <span class=s2>&#34;I&#39;m undecided whether to invest in Tesla or Palantir. My investment horizon is 5-7 years and I want maximum returns, I can handle high risk&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>],</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;contextId&#34;</span><span class=p>:</span> <span class=s2>&#34;demo_session&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div><h2 id=63-phase-3-automatic-risk-tolerance-inference>6.3 Phase 3: Automatic Risk Tolerance Inference</h2><h3 id=631-llm-call-for-risk-assessment>6.3.1 LLM Call for Risk Assessment</h3><p>The system semantically analyzes the user query to automatically infer the risk profile:</p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-plaintext"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=cl>2025-08-30 19:09:40 - groupchat_agent.a2a_agent - INFO - Inferred risk_tolerance: seeking from user message</span></span></code></pre></div></div><p><strong>LLM Prompt used</strong>:</p><div class="code-block code-line-numbers" style="counter-reset:code-block 0"><div class="code-header language-python"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>You are a financial risk tolerance classifier. 
</span></span></span><span class=line><span class=cl><span class=s2>Analyze the user&#39;s message to determine their risk tolerance profile.
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>RISK TOLERANCE LEVELS:
</span></span></span><span class=line><span class=cl><span class=s2>- &#34;averse&#34;: Conservative investors (capital preservation, stable returns, dividends)
</span></span></span><span class=line><span class=cl><span class=s2>- &#34;neutral&#34;: Balanced investors (moderate growth with reasonable risk)  
</span></span></span><span class=line><span class=cl><span class=s2>- &#34;seeking&#34;: Aggressive investors (high returns, accept high volatility)
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>User message: &#34;I&#39;m undecided whether to invest in Tesla or Palantir. My investment horizon is 5-7 years and I want maximum returns, I can handle high risk&#34;
</span></span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;</span></span></span></code></pre></div></div><p><strong>Result</strong>: <code>risk_tolerance: "seeking"</code></p><p>As expected, the system identified an aggressive profile based on &ldquo;maximum returns&rdquo; and &ldquo;I can handle high risk&rdquo;.</p><h2 id=64-phase-4-agent-discovery-and-intelligent-routing>6.4 Phase 4: Agent Discovery and Intelligent Routing</h2><h3 id=641-agent-card-retrieval-from-agent-registry>6.4.1 Agent Card Retrieval from Agent Registry</h3><p>The Group Chat Agent queries the Agent Registry to get Agent Card and endpoints of requested agents:</p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-plaintext"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=cl>2025-08-30 19:09:40 - groupchat_agent.registry_service - INFO - Fetching specialist agent URLs from registry...
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>HTTP Request: GET http://localhost:8000/agents?name=valuation
</span></span><span class=line><span class=cl>HTTP Request: GET http://localhost:8000/agents?name=sentiment  
</span></span><span class=line><span class=cl>HTTP Request: GET http://localhost:8000/agents?name=fundamental
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>2025-08-30 19:09:40 - groupchat_agent.registry_service - INFO - Found agent &#39;valuation&#39; at http://0.0.0.0:3001/
</span></span><span class=line><span class=cl>2025-08-30 19:09:40 - groupchat_agent.registry_service - INFO - Found agent &#39;sentiment&#39; at http://0.0.0.0:3002
</span></span><span class=line><span class=cl>2025-08-30 19:09:40 - groupchat_agent.registry_service - INFO - Found agent &#39;fundamental&#39; at http://0.0.0.0:3003/</span></span></code></pre></div></div><h3 id=642-routing-llm-for-agent-selection>6.4.2 Routing LLM for Agent Selection</h3><p>The system uses a prompt to determine which agents to involve:</p><p><strong>LLM Routing Prompt</strong>:</p><div class="code-block code-line-numbers" style="counter-reset:code-block 0"><div class="code-header language-python"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>You are a routing coordinator for financial analysis agents. 
</span></span></span><span class=line><span class=cl><span class=s2>Analyze the user&#39;s request and determine which specialist agents should be consulted:
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>AVAILABLE AGENTS:
</span></span></span><span class=line><span class=cl><span class=s2>- valuation: Technical analysis, price charts, volatility, quantitative metrics
</span></span></span><span class=line><span class=cl><span class=s2>- sentiment: News analysis, market sentiment, social media trends  
</span></span></span><span class=line><span class=cl><span class=s2>- fundamental: Financial reports, earnings, company fundamentals, SEC filings
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>User request: I&#39;m undecided whether to invest in Tesla or Palantir. My investment horizon is 5-7 years and I want maximum returns, I can handle high risk
</span></span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;</span></span></span></code></pre></div></div><p><strong>Result</strong>:</p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-plaintext"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=cl>2025-08-30 19:09:41 - groupchat_agent.a2a_agent - INFO - ü§ñ LLM ROUTING RESPONSE: [&#34;valuation&#34;, &#34;sentiment&#34;, &#34;fundamental&#34;]
</span></span><span class=line><span class=cl>2025-08-30 19:09:41 - groupchat_agent.a2a_agent - INFO - Determined required agents: [&#39;valuation&#39;, &#39;sentiment&#39;, &#39;fundamental&#39;]</span></span></code></pre></div></div><h3 id=643-decision-for-structured-debate>6.4.3 Decision for Structured Debate</h3><p>Another prompt determines if the query requires structured debate or simple coordination:</p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-plaintext"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=cl>2025-08-30 19:09:41 - groupchat_agent.a2a_agent - INFO - ü§î LLM DEBATE DECISION: YES for query: &#39;I&#39;m undecided whether to invest in Tesla or Pala...&#39;
</span></span><span class=line><span class=cl>2025-08-30 19:09:41 - groupchat_agent.a2a_agent - INFO - Multi-agent analysis detected - initiating structured debate</span></span></code></pre></div></div><h2 id=65-phase-5-round-1---initial-analysis>6.5 Phase 5: Round 1 - Initial Analysis</h2><p>The structured debate mechanism with round-robin is activated. Each agent presents its initial analysis sequentially.</p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-plaintext"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=cl>2025-08-30 19:09:41 - groupchat_agent.a2a_agent - INFO - Starting structured debate with agents: [&#39;valuation&#39;, &#39;sentiment&#39;, &#39;fundamental&#39;]
</span></span><span class=line><span class=cl>2025-08-30 19:09:41 - groupchat_agent.a2a_agent - INFO - === INITIAL ANALYSIS ROUND ===</span></span></code></pre></div></div><h3 id=651-valuation-agent---round-1>6.5.1 Valuation Agent - Round 1</h3><p><strong>Ticker Resolution</strong>:
The Valuation Agent begins by resolving company names to stock tickers, then retrieves financial data, calculates valuation metrics, and finally generates a brief synthesis report recommending investment in Palantir:</p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-bash"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>&gt; Entering new AgentExecutor chain...
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Invoking: <span class=sb>`</span>resolve_company_ticker<span class=sb>`</span> with <span class=sb>`</span><span class=o>{</span><span class=s1>&#39;query&#39;</span>: <span class=s1>&#39;Tesla&#39;</span><span class=o>}</span><span class=sb>`</span>
</span></span><span class=line><span class=cl>‚Üí <span class=o>{</span><span class=s1>&#39;success&#39;</span>: True, <span class=s1>&#39;query&#39;</span>: <span class=s1>&#39;Tesla&#39;</span>, <span class=s1>&#39;ticker&#39;</span>: <span class=s1>&#39;TSLA&#39;</span>, <span class=s1>&#39;company_name&#39;</span>: <span class=s1>&#39;Tesla, Inc.&#39;</span>, <span class=s1>&#39;resolution_method&#39;</span>: <span class=s1>&#39;company_mapping&#39;</span><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Invoking: <span class=sb>`</span>resolve_company_ticker<span class=sb>`</span> with <span class=sb>`</span><span class=o>{</span><span class=s1>&#39;query&#39;</span>: <span class=s1>&#39;Palantir&#39;</span><span class=o>}</span><span class=sb>`</span>  
</span></span><span class=line><span class=cl>‚Üí <span class=o>{</span><span class=s1>&#39;success&#39;</span>: False, <span class=s1>&#39;query&#39;</span>: <span class=s1>&#39;Palantir&#39;</span>, <span class=s1>&#39;error&#39;</span>: <span class=s2>&#34;Could not resolve &#39;Palantir&#39; to a valid stock ticker&#34;</span><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Invoking: <span class=sb>`</span>resolve_company_ticker<span class=sb>`</span> with <span class=sb>`</span><span class=o>{</span><span class=s1>&#39;query&#39;</span>: <span class=s1>&#39;PLTR&#39;</span><span class=o>}</span><span class=sb>`</span>
</span></span><span class=line><span class=cl>‚Üí <span class=o>{</span><span class=s1>&#39;success&#39;</span>: True, <span class=s1>&#39;query&#39;</span>: <span class=s1>&#39;PLTR&#39;</span>, <span class=s1>&#39;ticker&#39;</span>: <span class=s1>&#39;PLTR&#39;</span>, <span class=s1>&#39;company_name&#39;</span>: <span class=s1>&#39;Palantir Technologies Inc.&#39;</span>, <span class=s1>&#39;resolution_method&#39;</span>: <span class=s1>&#39;direct_ticker&#39;</span><span class=o>}</span></span></span></code></pre></div></div><p><strong>Financial Data Retrieval</strong>:</p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-bash"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>Invoking: <span class=sb>`</span>fetch_stock_data<span class=sb>`</span> with <span class=sb>`</span><span class=o>{</span><span class=s1>&#39;symbol&#39;</span>: <span class=s1>&#39;TSLA&#39;</span>, <span class=s1>&#39;period_days&#39;</span>: 365<span class=o>}</span><span class=sb>`</span>
</span></span><span class=line><span class=cl>‚Üí Successfully fetched <span class=m>250</span> data points <span class=k>for</span> TSLA
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Invoking: <span class=sb>`</span>fetch_stock_data<span class=sb>`</span> with <span class=sb>`</span><span class=o>{</span><span class=s1>&#39;symbol&#39;</span>: <span class=s1>&#39;PLTR&#39;</span>, <span class=s1>&#39;period_days&#39;</span>: 365<span class=o>}</span><span class=sb>`</span>  
</span></span><span class=line><span class=cl>‚Üí Successfully fetched <span class=m>250</span> data points <span class=k>for</span> PLTR</span></span></code></pre></div></div><p><strong>Volatility and Metrics Calculations</strong>:</p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-bash"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>Invoking: <span class=sb>`</span>calculate_volatility_metrics<span class=sb>`</span> with <span class=sb>`</span><span class=o>{</span><span class=s1>&#39;symbol&#39;</span>: <span class=s1>&#39;TSLA&#39;</span><span class=o>}</span><span class=sb>`</span>
</span></span><span class=line><span class=cl>Invoking: <span class=sb>`</span>calculate_volatility_metrics<span class=sb>`</span> with <span class=sb>`</span><span class=o>{</span><span class=s1>&#39;symbol&#39;</span>: <span class=s1>&#39;PLTR&#39;</span><span class=o>}</span><span class=sb>`</span></span></span></code></pre></div></div><p><strong>Valuation Agent Comparative Analysis</strong>:</p><p><strong>Tesla (TSLA)</strong>:</p><ul><li>Current Price: $333.87</li><li>Total Return (1 year): <strong>58.53%</strong></li><li>Annualized Return: <strong>59.42%</strong></li><li>Annualized Volatility: <strong>71.44%</strong></li><li>Sharpe Ratio: <strong>0.76</strong></li><li>Max Drawdown: <strong>-53.77%</strong></li></ul><p><strong>Palantir (PLTR)</strong>:</p><ul><li>Current Price: $156.71</li><li>Total Return (1 year): <strong>413.63%</strong></li><li>Annualized Return: <strong>423.86%</strong></li><li>Annualized Volatility: <strong>72.53%</strong></li><li>Sharpe Ratio: <strong>5.77</strong></li><li>Max Drawdown: <strong>-40.61%</strong></li></ul><p><strong>Valuation Agent Recommendation</strong>:</p><blockquote><p><em><strong>STRONG BUY Palantir</strong></em><br><em>Palantir&rsquo;s superior risk-adjusted returns and extraordinary growth potential make it a more attractive option for maximizing returns.</em></p></blockquote><h3 id=652-sentiment-agent---round-1>6.5.2 Sentiment Agent - Round 1</h3><p>The Sentiment Agent searches for news about Tesla and Palantir on Yahoo Finance and Google News, retrieves the text of the articles, and calculates sentiment scores using VADER and TextBlob.</p><p><strong>Financial News Collection</strong>:</p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-plaintext"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=cl>2025-08-30 19:10:08 - sentiment_agent.tools - INFO - Collecting news for TSLA (Tesla, Inc.)
</span></span><span class=line><span class=cl>2025-08-30 19:10:08 - sentiment_agent.tools - INFO - Collecting news for PLTR (Palantir Technologies Inc.)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>HTTP Request: GET https://feeds.finance.yahoo.com/rss/2.0/headline?s=TSLA&amp;region=US&amp;lang=en-US
</span></span><span class=line><span class=cl>HTTP Request: GET https://feeds.finance.yahoo.com/rss/2.0/headline?s=PLTR&amp;region=US&amp;lang=en-US
</span></span><span class=line><span class=cl>HTTP Request: GET https://news.google.com/rss/search?q=&#34;Tesla,+Inc.&#34;+OR+&#34;TSLA&#34;+stock+finance
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>2025-08-30 19:10:09 - sentiment_agent.tools - INFO - Successfully collected 9 articles for TSLA
</span></span><span class=line><span class=cl>2025-08-30 19:10:09 - sentiment_agent.tools - INFO - Successfully collected 6 articles for PLTR</span></span></code></pre></div></div><p><strong>Sentiment Analysis with VADER + TextBlob</strong>:</p><p><strong>Tesla (TSLA)</strong>:</p><ul><li>Overall Sentiment: <strong>Neutral</strong></li><li>TextBlob Average: 0.0024</li><li>VADER Average: -0.0651</li><li>Combined Average: <strong>-0.0381</strong> (slight negative trend)</li><li>Distribution: 22% positive, 33% negative, 44% neutral</li></ul><p><strong>Palantir (PLTR)</strong>:</p><ul><li>Overall Sentiment: <strong>Positive</strong></li><li>TextBlob Average: 0.0235</li><li>VADER Average: 0.4288</li><li>Combined Average: <strong>0.2667</strong> (moderately positive)</li><li>Distribution: 83% positive, 17% negative</li></ul><p><strong>Key Tesla News Analysis</strong>:</p><ul><li><strong>Negative</strong>: &ldquo;Nearly Half Of Americans Say Tesla FSD Should Be Illegal&rdquo;</li><li><strong>Negative</strong>: &ldquo;Tesla&rsquo;s sales down 40% in EU while Chinese EV maker BYD is up 200%&rdquo;</li><li><strong>Positive</strong>: &ldquo;Tesla Stock is Going Up Today? TSLA Shares Jump to June Highs on Elon Musk&rsquo;s FSD Optimism&rdquo;</li></ul><p><strong>Key Palantir News Analysis</strong>:</p><ul><li><strong>Positive</strong>: &ldquo;Palantir Technologies Inc. (PLTR)&rsquo;s New Name Is &lsquo;Karpe Diem,&rsquo; Says Jim Cramer&rdquo;</li><li><strong>Positive</strong>: &ldquo;Moody&rsquo;s Just Upgraded The Top S&amp;P 500 Stock Not Named Palantir&rdquo;</li></ul><p><strong>Sentiment Agent Recommendation</strong>:</p><blockquote><p><em><strong>BUY Palantir</strong></em><br><em>Strong positive sentiment and market performance vs Tesla&rsquo;s neutral sentiment with regulatory challenges.</em></p></blockquote><h3 id=653-fundamental-agent---round-1>6.5.3 Fundamental Agent - Round 1</h3><p>The output of the Fundamental Agent is much more articulated and detailed. In particular, it did not indicate a specific investment preference, but instead suggested a bivalent strategy (SELL on Tesla and BUY on Palantir)</p><p><strong>In-Depth Financial Analysis</strong>:</p><p>Initially, the agent retrieves and examines the financial reports of both companies, highlighting their performance and key metrics. The data is retrieved through Yahoo Finance APIs.</p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-plaintext"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=cl>2025-08-30 19:10:38 - fundamental_agent.tools - INFO - Pulling financial reports for TSLA (Tesla, Inc.)
</span></span><span class=line><span class=cl>2025-08-30 19:10:40 - fundamental_agent.tools - INFO - Successfully retrieved financial reports for TSLA
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>2025-08-30 19:10:40 - fundamental_agent.tools - INFO - Pulling financial reports for PLTR (Palantir Technologies Inc.) 
</span></span><span class=line><span class=cl>2025-08-30 19:10:42 - fundamental_agent.tools - INFO - Successfully retrieved financial reports for PLTR</span></span></code></pre></div></div><p><strong>RAG-based Analysis Results</strong>:</p><p>As anticipated earlier, this is not true RAG analysis, but rather a search for relevant information starting from Yahoo Finance API output. Starting from the retrieved financial data, the agent calculates KPIs of interest and produces an &ldquo;expert&rdquo; opinion.</p><p><strong>Tesla (TSLA)</strong>:</p><ul><li>Sector: Consumer Cyclical - Auto Manufacturers</li><li><strong>Gross Margin</strong>: 17.48%</li><li><strong>Operating Margin</strong>: 4.10%</li><li><strong>Revenue Growth</strong>: <strong>-11.80%</strong> (negative)</li><li><strong>Earnings Growth</strong>: <strong>-17.50%</strong> (negative)</li><li><strong>Fundamental Score</strong>: <strong>0/100</strong></li><li><strong>Investment Recommendation</strong>: <strong>SELL</strong></li></ul><blockquote><p><strong>Concerns</strong>: <em>&ldquo;Low operating margin indicates operational challenges, negative revenue growth indicates declining business&rdquo;</em></p></blockquote><p><strong>Palantir (PLTR)</strong>:</p><ul><li>Sector: Technology - Software Infrastructure</li><li><strong>Gross Margin</strong>: <strong>80.03%</strong> (excellent)</li><li><strong>Operating Margin</strong>: <strong>26.83%</strong> (strong)</li><li><strong>Revenue Growth</strong>: <strong>48.00%</strong> (robust)</li><li><strong>Earnings Growth</strong>: <strong>116.70%</strong> (extraordinary)</li><li><strong>Fundamental Score</strong>: <strong>100/100</strong></li><li><strong>Investment Recommendation</strong>: <strong>BUY</strong></li></ul><blockquote><p><strong>Strengths</strong>: <em>Strong gross margin indicates good pricing power, Strong operating margin indicates efficient operations, Strong revenue growth indicates market expansion</em></p></blockquote><p><strong>Round 1 Conclusions</strong>:</p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-plaintext"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=cl>2025-08-30 19:11:12 - groupchat_agent.a2a_agent - INFO - fundamental completed turn 1</span></span></code></pre></div></div><h2 id=66-round-2-debate>6.6 Round 2 Debate</h2><p>The system proceeds with Round 2 of the structured debate, where each agent has the opportunity to respond to the analyses of others:</p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-plaintext"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=cl>2025-08-30 19:11:12 - groupchat_agent.a2a_agent - INFO - === DEBATE ROUND 2 ===
</span></span><span class=line><span class=cl>2025-08-30 19:11:12 - groupchat_agent.a2a_agent - INFO - Round 2: valuation&#39;s turn (turn #2)</span></span></code></pre></div></div><h3 id=661-debate>6.6.1 Debate</h3><p>In Round 2, agents have access to the analyses of other agents and can present counter-arguments or strengthen their positions. This process allows for:</p><ul><li><strong>Identifying disagreements</strong>: Tesla vs Palantir as optimal investment</li><li><strong>Comparing methodologies</strong>: Technical vs fundamental vs sentiment analysis</li><li><strong>Refining recommendations</strong>: Based on peer-to-peer feedback</li><li><strong>Cross-validation</strong>: Cross-reference between different analytical perspectives</li></ul><h3 id=662-consensus-building-process>6.6.2 Consensus Building Process</h3><p>The Group agent has a threshold for consensus among agents that is configured via an environment variable. Specifically, I left the default value of 75%, but it could be adjusted based on debate needs.
In any case, for the test performed there were no significant differences in response, so it was very easy to reach consensus.</p><p>Nevertheless, before proceeding to the consolidation phase, the group agent still highlighted some distinctive elements of the responses from the 3 agents, and then provided a synthesis comment:</p><blockquote><ol><li><p><strong>Valuation vs Fundamental divergence on Tesla</strong>:</p><ul><li><strong>Valuation Agent</strong>: Tesla showed 59.42% annualized return ‚Üí Potential BUY</li><li><strong>Fundamental Agent</strong>: Tesla has -11.80% revenue growth, 4.10% operating margins ‚Üí SELL</li></ul></li><li><p><strong>Consensus on Palantir</strong>:</p><ul><li><strong>Valuation</strong>: 423.86% annualized return, Sharpe 5.77 ‚Üí STRONG BUY</li><li><strong>Fundamental</strong>: Score 100/100, 80.03% margins ‚Üí BUY</li><li><strong>Sentiment</strong>: 83% positive sentiment ‚Üí BUY</li></ul></li><li><p><strong>Risk-adjusted perspective</strong>:</p><ul><li><strong>All agree</strong>: For risk-seeking investor with 5-7 year horizon, Palantir is superior to Tesla</li></ul></li></ol></blockquote><h2 id=67-phase-7-final-consolidation-and-report-generation>6.7 Phase 7: Final Consolidation and Report Generation</h2><h3 id=671-llm-based-synthesis>6.7.1 LLM-based Synthesis</h3><p>The Group Chat Agent uses an LLM with ad-hoc prompts to consolidate multiple analyses.
To give an idea of how the process works, I report an example of prompt used, with some variables that refer to the context:</p><p><strong>Consolidation Prompt</strong>:</p><div class="code-block code-line-numbers" style="counter-reset:code-block 0"><div class="code-header language-python"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>You are a financial analysis consolidator. Your role is to synthesize insights from multiple specialist agents into a coherent response.
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>USER REQUEST: I&#39;m undecided whether to invest in Tesla or Palantir. My investment horizon is 5-7 years and I want maximum returns, I can handle high risk
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>AGENT ANALYSES:
</span></span></span><span class=line><span class=cl><span class=s2>**VALUATION AGENT:**
</span></span></span><span class=line><span class=cl><span class=s2>[Complete analysis with quantitative metrics...]
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>**SENTIMENT AGENT:** 
</span></span></span><span class=line><span class=cl><span class=s2>[Sentiment analysis with news distribution...]
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>**FUNDAMENTAL AGENT:**
</span></span></span><span class=line><span class=cl><span class=s2>[Fundamental analysis with score...]
</span></span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;</span></span></span></code></pre></div></div><h3 id=672-final-report>6.7.2 Final Report</h3><p>The system generates a complete final report that integrates all specialist analyses. Here is the report in its entirety:</p><hr><p><strong>üìä ALPHAAGENTS INVESTMENT ANALYSIS REPORT</strong></p><p>The analysis of whether to invest in Tesla (TSLA) or Palantir (PLTR) over a 5-7 year horizon, with a focus on maximizing returns and a willingness to manage high risk, was conducted through a structured multi-agent debate process. This comprehensive approach involved valuation, sentiment, and fundamental analyses, ensuring a well-rounded perspective.</p><p><strong>üéØ CONSENSUS AND KEY FINDINGS:</strong></p><p><strong>1. Palantir Technologies Inc. (PLTR)</strong></p><ul><li><strong>Valuation</strong>: Palantir has demonstrated an extraordinary annualized return of 423.86% with a high Sharpe ratio of 5.77, indicating exceptional risk-adjusted returns. The volatility is high, but the risk-reward profile is favorable.</li><li><strong>Sentiment</strong>: The sentiment analysis shows a strong positive outlook, with 83% of articles reflecting positive sentiment. This aligns with the valuation analysis, reinforcing Palantir&rsquo;s growth potential.</li><li><strong>Fundamentals</strong>: Palantir&rsquo;s strong growth metrics and operational efficiency support the positive sentiment and valuation findings.</li></ul><p><strong>Recommendation: STRONG BUY</strong>. Palantir is recommended for risk-seeking investors due to its exceptional growth potential and positive sentiment, making it an attractive option for maximizing returns.</p><p><strong>2. Tesla, Inc. (TSLA):</strong></p><ul><li><strong>Valuation</strong>: Tesla has a strong annualized return of 59.42% with high volatility. The Sharpe ratio of 0.76 suggests moderate risk-adjusted returns. The potential for significant returns exists, but with substantial risk.</li><li><strong>Sentiment</strong>: The sentiment analysis is neutral with a slight negative tilt, reflecting concerns about automotive sector challenges and regulatory issues with Tesla&rsquo;s Full Self-Driving technology.</li><li><strong>Fundamentals</strong>: Operational challenges and strategic uncertainties contribute to a more cautious outlook.</li></ul><p><strong>Recommendation: HOLD</strong>. While Tesla has potential upside, the current sentiment and operational challenges suggest a more cautious approach. Investors should wait for more positive sentiment or strategic clarity before increasing exposure.</p><p><strong>üèÜ FINAL RECOMMENDATION:</strong></p><p>Based on the collective reasoning from the multi-agent debate, <strong>Palantir (PLTR)</strong> is the preferred choice for a risk-seeking investor aiming for maximum returns over a 5-7 year horizon. Its strong positive sentiment, exceptional risk-adjusted returns, and growth potential make it a compelling investment.</p><p><strong>Tesla (TSLA)</strong>, while still a strong contender, is recommended as a hold due to its current neutral sentiment and operational challenges. Investors should monitor Tesla for strategic developments that could enhance its investment appeal.</p><p>This analysis benefits from the collaborative insights of multiple expert perspectives, providing increased confidence in the recommendations provided.</p><hr><h3 id=673-debate-process-metadata>6.7.3 Debate Process Metadata</h3><p>The final report also includes some metadata about the process followed, which can be used for explainability analysis:</p><div class="code-block code-line-numbers" style="counter-reset:code-block 0"><div class="code-header language-json"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;debate_metadata&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;total_rounds&#34;</span><span class=p>:</span> <span class=mi>2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;agents_participated&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;valuation&#34;</span><span class=p>,</span> <span class=s2>&#34;sentiment&#34;</span><span class=p>,</span> <span class=s2>&#34;fundamental&#34;</span><span class=p>],</span>  
</span></span><span class=line><span class=cl>    <span class=nt>&#34;consensus_achieved&#34;</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;consensus_percentage&#34;</span><span class=p>:</span> <span class=mi>100</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;risk_tolerance_inferred&#34;</span><span class=p>:</span> <span class=s2>&#34;seeking&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;debate_duration&#34;</span><span class=p>:</span> <span class=s2>&#34;3m 32s&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;llm_calls&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;risk_inference&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;agent_routing&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>      <span class=nt>&#34;debate_detection&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;consolidation&#34;</span><span class=p>:</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div><h2 id=68-performance-and-execution-times>6.8 Performance and Execution Times</h2><p>An important aspect to document is the time needed to complete the entire analysis process. Based on the timestamps recorded during execution, here is the detailed temporal breakdown:</p><h3 id=681-overall-duration>6.8.1 Overall Duration</h3><p><strong>Total execution time</strong>: <strong>3 minutes and 32 seconds</strong> (from 19:09:40 to 19:13:12)</p><h3 id=682-temporal-breakdown-by-phases>6.8.2 Temporal Breakdown by Phases</h3><table><thead><tr><th>Phase</th><th>Duration</th><th>Start Timestamp</th><th>End Timestamp</th><th>Description</th></tr></thead><tbody><tr><td><strong>Initial Setup</strong></td><td>~41s</td><td>19:06:50</td><td>19:07:31</td><td>Launch of all agents, Agent Registry, Healthcheck and basic verifications</td></tr><tr><td><strong>Query Processing</strong></td><td>~1s</td><td>19:09:40</td><td>19:09:41</td><td>User query reception and parsing</td></tr><tr><td><strong>Risk Tolerance Inference</strong></td><td>&lt;1s</td><td>19:09:40</td><td>19:09:40</td><td>LLM analysis to infer risk profile</td></tr><tr><td><strong>Agent Discovery</strong></td><td>&lt;1s</td><td>19:09:40</td><td>19:09:40</td><td>Endpoint retrieval from Agent Registry</td></tr><tr><td><strong>Agent Routing</strong></td><td>~1s</td><td>19:09:41</td><td>19:09:41</td><td>LLM decision on agents to involve</td></tr><tr><td><strong>Debate Detection</strong></td><td>&lt;1s</td><td>19:09:41</td><td>19:09:41</td><td>LLM decision for structured debate</td></tr><tr><td><strong>Round 1 Analysis</strong></td><td><strong>~91s</strong></td><td>19:09:41</td><td>19:11:12</td><td>Sequential initial analyses of 3 agents</td></tr><tr><td><strong>Round 2 Debate</strong></td><td><strong>~120s</strong></td><td>19:11:12</td><td>19:13:12</td><td>Second round and final consolidation</td></tr></tbody></table><h3 id=683-analysis-of-most-expensive-components>6.8.3 Analysis of Most Expensive Components</h3><p><strong>The most time-intensive phases are</strong>:</p><ol><li><p><strong>Round 1 Analysis (91 seconds)</strong>:</p><ul><li><strong>Valuation Agent</strong>: ~30s for Yahoo Finance data retrieval + volatility calculations</li><li><strong>Sentiment Agent</strong>: ~30s for news collection from multiple sources + VADER/TextBlob analysis</li><li><strong>Fundamental Agent</strong>: ~31s for financial data processing + keyword matching</li></ul></li><li><p><strong>Round 2 Debate (120 seconds)</strong>:</p><ul><li><strong>Structured debate</strong>: ~60s for second round of cross-agent analysis</li><li><strong>LLM Consolidation</strong>: ~60s for final synthesis and report generation</li></ul></li></ol><h3 id=684-bottlenecks-and-possible-optimizations>6.8.4 Bottlenecks and Possible Optimizations</h3><p><strong>Identified bottlenecks</strong>:</p><ul><li><strong>API Latency</strong>: Calls to Yahoo Finance (~2-3s per request)</li><li><strong>LLM Processing</strong>: Complex analyses require 10-15s per agent</li><li><strong>Sequential Execution</strong>: Sequential turns not parallelizable by design</li></ul><p><strong>Future optimizations</strong>:</p><ul><li><strong>Round 1 Parallelization</strong>: Potential reduction from 91s to ~35-40s</li><li><strong>Financial data caching</strong>: Avoid multiple retrievals of same tickers</li><li><strong>Model optimization</strong>: More efficient prompts or faster models</li></ul><h3 id=685-performance-considerations>6.8.5 Performance Considerations</h3><p>The time of <strong>3:32 minutes</strong> represents an <strong>optimal compromise</strong> for the financial use case:</p><p>‚úÖ <strong>Acceptable for</strong>:</p><ul><li>Financial analyses where accuracy > speed</li><li>Investors requiring multi-perspective validation</li><li>Medium to long-term investment decisions</li></ul><p>‚ö†Ô∏è <strong>To improve for</strong>:</p><ul><li>High-frequency trading</li><li>Real-time market analysis</li><li>Scenarios with high volume of simultaneous requests</li></ul><h2 id=69-end-to-end-process-conclusions>6.9 End-to-End Process Conclusions</h2><p>This complete trace demonstrates how the AlphaAgents system automatically orchestrates a sophisticated analysis process in <strong>3:32 minutes</strong>, including:</p><ol><li><strong>Intelligent discovery</strong> of agents via Agent Registry</li><li><strong>Automatic inference</strong> of risk tolerance via LLM semantic analysis</li><li><strong>Multilingual routing</strong> to identify relevant agents</li><li><strong>Structured debate</strong> with strict turn-taking and consensus building</li><li><strong>Sequential specialist analyses</strong> with advanced tool calling</li><li><strong>Multi-perspective consolidation</strong> via LLM meta-prompt</li><li><strong>Final report</strong> with complete process metadata</li></ol><p><strong>Final result</strong>: <strong>Strong recommendation for Palantir Technologies</strong> based on unanimous agent consensus, supported by:</p><ul><li>Superior return metrics (423% vs 59%)</li><li>Positive sentiment vs neutral for Tesla</li><li>Solid fundamentals (80% margins vs 17% for Tesla)</li><li>Alignment with risk-seeking profile and 5-7 year horizon</li></ul><p>This multi-agent approach with structured debate allowed for clearly identifying the optimal investment through collaborative validation and individual bias mitigation, demonstrating the effectiveness of the A2A-compliant framework in real financial analysis scenarios with reasonable performance for the application domain.</p><h1 id=7-conclusions>7. Conclusions</h1><h2 id=71-project-motivations-and-objectives>7.1 Project Motivations and Objectives</h2><p>This project was born from the need to <strong>concretely test the A2A protocol and Agent Registry</strong> in a real application scenario, to experiment with a distributed multi-agent application.</p><p>As I highlighted in the introduction, the proliferation of monolithic GenAI frameworks and their limitations in multi-agent support pushed me to invest some time to <strong>raise the level of abstraction</strong> and try to design an A2A-based agent architecture, in order to guarantee:</p><ul><li><strong>Communication standardization</strong> between heterogeneous agents</li><li><strong>Elimination of lock-in</strong> to specific frameworks</li><li><strong>Horizontal scalability</strong> through distributed deployments</li><li><strong>Interoperability</strong> between agents implemented with different technology stacks</li></ul><p>This small project kept me up a few nights but gave me the chance to get hands-on with <strong>a REAL multi-agent system</strong> different from the monolithic case study that is often presented in the &ldquo;Getting Started&rdquo; section of this or that GenAI framework.</p><p>I&rsquo;m increasingly convinced that for Enterprise solutions, it&rsquo;s worth starting to think seriously about agent architecture and collaboration protocols rather than the specific technology stack for implementing this or that Use Case.</p><h2 id=72-the-choice-of-alphaagents>7.2 The Choice of AlphaAgents</h2><p>The selection of the <strong>BlackRock AlphaAgents</strong> paper as a use case proved particularly successful because, despite not overly high complexity, it allowed me to create an end-to-end solution with tangible and measurable results.</p><p>Compared to the original paper, I had to accept some compromises to simplify implementation, but this did not compromise achieving my objective.</p><h2 id=73-future-developments>7.3 Future Developments</h2><p>The end-to-end test confirmed the validity of the approach and also provided me with some insights for future improvements.</p><h3 id=741-technical-improvements>7.4.1 Technical Improvements</h3><p><strong>Performance Optimization</strong>:</p><ul><li><strong>Round 1 Parallelization</strong>: Potential reduction from 91s to ~35s</li><li><strong>Data caching</strong>: Avoid multiple retrievals of same tickers</li><li><strong>LLM optimization</strong>: Prompt engineering to reduce latency</li></ul><p><strong>Agent reliability</strong>:</p><ul><li><strong>Sentiment Agent</strong>: FinBERT integration for more accurate analysis</li><li><strong>Fundamental Agent</strong>: True RAG implementation with vector embeddings</li><li><strong>Risk Assessment</strong>: More sophisticated models for portfolio risk management</li></ul><p><strong>Registry improvements</strong>:</p><ul><li><strong>Agent versioning</strong> and compatibility management</li><li><strong>Load balancing</strong> for agents with multiple instances</li><li><strong>Health monitoring</strong> and automatic failover</li></ul><h3 id=742-functional-expansions>7.4.2 Functional Expansions</h3><p><strong>New Specialized Agents</strong>:</p><ul><li><strong>Technical Analysis Agent</strong>: Pattern recognition, support/resistance</li><li><strong>Macro Economic Agent</strong>: Macroeconomic and sectoral analysis</li><li><strong>ESG Agent</strong>: Environmental, Social, Governance scoring</li><li><strong>Options Agent</strong>: Derivatives analysis and hedging strategies</li></ul><p><strong>Accurate results verification</strong>:</p><ul><li><strong>Double check</strong> of metrics calculated by Valuation Agent on large data samples</li><li><strong>Cross-validation</strong> with other valuation models</li></ul><h2 id=75-considerations-on-financial-results>7.5 Considerations on Financial Results</h2><h3 id=751-limitations-and-risks>7.5.1 Limitations and Risks</h3><p><strong>Technical Limitations</strong>:</p><ul><li><strong>Limited data</strong>: Much of the analysis is based on Yahoo Finance data, not professional sources</li><li><strong>Lack of backtesting</strong>: As I emphasized multiple times, I performed no systematic validation on historical data</li><li><strong>Restricted scope</strong>: The analysis sample on which I did end-to-end tests is limited to few stocks and few types of user requests</li></ul><p><strong>Risks</strong>:</p><ul><li><strong>LLM hallucinations</strong>: Possible erroneous or contradictory analyses</li><li><strong>Data quality</strong>: Input data accuracy not guaranteed</li><li><strong>Model bias</strong>: Bias in language models used</li><li><strong>Market conditions</strong>: Doesn&rsquo;t consider current macroeconomic conditions</li></ul><h3 id=752--important-disclaimer>7.5.2 ‚ö†Ô∏è Important Disclaimer</h3><p>Also in light of the limitations indicated above, all results, recommendations and analyses presented in this article are <strong>exclusively for exemplification purposes</strong> to illustrate the multi-agent system operation.</p><p><strong>The results reported here and the software released on GitHub must NOT be used in any way as</strong>:</p><ul><li>Basis for real investment decisions</li><li>Financial advice or trading recommendations</li><li>Input for portfolio management strategies</li></ul><hr></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on August 31, 2025</span></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span><a href=javascript:void(0); title="Share on X" data-sharer=x data-url=https://c-daniele.github.io/en/posts/2025-08-31-alphaagents-a2a/ data-title="AlphaAgents: Multi-Agent A2A Implementation for Collaborative Financial Analysis" data-hashtags=GenAI,Langchain,Agents><i class="fab fa-x-twitter fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Threads" data-sharer=threads data-url=https://c-daniele.github.io/en/posts/2025-08-31-alphaagents-a2a/ data-title="AlphaAgents: Multi-Agent A2A Implementation for Collaborative Financial Analysis"><i class="fab fa-threads fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Facebook" data-sharer=facebook data-url=https://c-daniele.github.io/en/posts/2025-08-31-alphaagents-a2a/ data-hashtag=GenAI><i class="fab fa-facebook-square fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Hacker News" data-sharer=hackernews data-url=https://c-daniele.github.io/en/posts/2025-08-31-alphaagents-a2a/ data-title="AlphaAgents: Multi-Agent A2A Implementation for Collaborative Financial Analysis"><i class="fab fa-hacker-news fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Line" data-sharer=line data-url=https://c-daniele.github.io/en/posts/2025-08-31-alphaagents-a2a/ data-title="AlphaAgents: Multi-Agent A2A Implementation for Collaborative Financial Analysis"><i data-svg-src=https://cdn.jsdelivr.net/npm/simple-icons@15.14.0/icons/line.svg aria-hidden=true></i></a><a href=javascript:void(0); title="Share on ÂæÆÂçö" data-sharer=weibo data-url=https://c-daniele.github.io/en/posts/2025-08-31-alphaagents-a2a/ data-title="AlphaAgents: Multi-Agent A2A Implementation for Collaborative Financial Analysis"><i class="fab fa-weibo fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Diaspora" data-sharer=diaspora data-url=https://c-daniele.github.io/en/posts/2025-08-31-alphaagents-a2a/ data-title="AlphaAgents: Multi-Agent A2A Implementation for Collaborative Financial Analysis" data-description><i class="fab fa-diaspora fa-fw" aria-hidden=true></i></a><a href="https://t.me/share/url?url=https%3a%2f%2fc-daniele.github.io%2fen%2fposts%2f2025-08-31-alphaagents-a2a%2f&amp;text=AlphaAgents%3a%20Multi-Agent%20A2A%20Implementation%20for%20Collaborative%20Financial%20Analysis" target=_blank title="Share on Telegram"><i class="fab fa-telegram fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw" aria-hidden=true></i>&nbsp;<a href=/en/tags/genai/>GenAI</a>,&nbsp;<a href=/en/tags/langchain/>Langchain</a>,&nbsp;<a href=/en/tags/agents/>Agents</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/en/>Home</a></span></section></div><div class=post-nav><a href=/en/posts/2025-08-15-agent-reg-for-a2a/ class=prev rel=prev title="Agent-Reg: Building an Open Agent Registry for A2A Protocol"><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>Agent-Reg: Building an Open Agent Registry for A2A Protocol</a>
<a href=/en/posts/2025-10-11-bells-inequalities/ class=next rel=next title="Bell's Inequalities: A quantum computing experiment with Qiskit">Bell's Inequalities: A quantum computing experiment with Qiskit<i class="fas fa-angle-right fa-fw" aria-hidden=true></i></a></div></div></article></div></main></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i></a></div><div id=fixed-buttons-hidden><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><script src=https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js></script><script src=https://cdn.jsdelivr.net/npm/lunr@2.3.9/lunr.min.js></script><script src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js></script><script src=https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js></script><script src=https://cdn.jsdelivr.net/npm/sharer.js@0.5.2/sharer.min.js></script><script>window.config={comment:{},search:{highlightTag:"em",lunrIndexURL:"/en/index.json",maxResultLength:10,noResultsFound:"No results found",snippetLength:30,type:"lunr"}}</script><script src=/js/theme.min.js></script><script>var dnt,doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-8NZQZ3Z1RN")}</script><script src="https://www.googletagmanager.com/gtag/js?id=G-8NZQZ3Z1RN" async></script></body></html>